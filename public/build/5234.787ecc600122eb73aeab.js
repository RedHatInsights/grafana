"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5234],{"./public/app/plugins/datasource/tempo/graphTransform.ts":(e,t,n)=>{n.d(t,{M7:()=>o,Yt:()=>s,yf:()=>u,t3:()=>c,BC:()=>l});var r=n("./packages/grafana-data/src/index.ts"),a=n("./public/app/core/utils/tracing.ts");function o(e){const{nodes:t,edges:n}=function(e){const t=[],n=[],o=new r.DataFrameView(e),i=function(e){let t=0,n=1/0;for(let r=0;r<e.length;r++){const a=e.get(r);a.startTime<n&&(n=a.startTime),a.startTime+a.duration>t&&(t=a.startTime+a.duration)}return t-n}(o),s=(0,a.nO)((t=>{if(t>=e.length)return;const n=o.get(t);return{span:Object.assign({},n),id:n.spanID,parentIds:n.parentSpanID?[n.parentSpanID]:[]}}));for(let e=0;e<o.length;e++){var u;const c=o.get(e),l=s[c.spanID].children.map((e=>{const t=s[e].span;return[t.startTime,t.startTime+t.duration]})),p=(0,a.et)(l),d=c.duration-p,f=(0,a.fy)(c.duration,i,d);t.push({[r.NodeGraphDataFrameFieldNames.id]:c.spanID,[r.NodeGraphDataFrameFieldNames.title]:null!==(u=c.serviceName)&&void 0!==u?u:"",[r.NodeGraphDataFrameFieldNames.subTitle]:c.operationName,[r.NodeGraphDataFrameFieldNames.mainStat]:f.main,[r.NodeGraphDataFrameFieldNames.secondaryStat]:f.secondary,[r.NodeGraphDataFrameFieldNames.color]:d/i}),c.parentSpanID&&s[c.parentSpanID].span&&n.push({[r.NodeGraphDataFrameFieldNames.id]:c.parentSpanID+"--"+c.spanID,[r.NodeGraphDataFrameFieldNames.target]:c.spanID,[r.NodeGraphDataFrameFieldNames.source]:c.parentSpanID})}return{nodes:t,edges:n}}(e),[o,i]=(0,a.np)();for(const e of t)o.add(e);for(const e of n)i.add(e);return[o,i]}const i="traces_service_graph_request_server_seconds_sum",s="traces_service_graph_request_total",u="traces_service_graph_request_failed_total",c=[i,s,u];function l(e,t){const n=function(e){return e[0].data.reduce(((e,t)=>(e[t.refId]=new r.DataFrameView(t),e)),{})}(e),a={},o={};return p(n[s],"total",s,a,o),p(n[i],"seconds",i,a,o),p(n[u],"failed",u,a,o),function(e,t,n){const a=n.to.valueOf()-n.from.valueOf(),[o,i]=function(){function e(e,t){return new r.MutableDataFrame({name:e,fields:t,meta:{preferredVisualisationType:"nodeGraph"}})}const t=e("Nodes",[{name:r.NodeGraphDataFrameFieldNames.id},{name:r.NodeGraphDataFrameFieldNames.title,config:{displayName:"Service name"}},{name:r.NodeGraphDataFrameFieldNames.mainStat,config:{unit:"ms/r",displayName:"Average response time"}},{name:r.NodeGraphDataFrameFieldNames.secondaryStat,config:{unit:"r/sec",displayName:"Requests per second"}},{name:r.NodeGraphDataFrameFieldNames.arc+"success",config:{displayName:"Success",color:{fixedColor:"green",mode:r.FieldColorModeId.Fixed}}},{name:r.NodeGraphDataFrameFieldNames.arc+"failed",config:{displayName:"Failed",color:{fixedColor:"red",mode:r.FieldColorModeId.Fixed}}}]),n=e("Edges",[{name:r.NodeGraphDataFrameFieldNames.id},{name:r.NodeGraphDataFrameFieldNames.source},{name:r.NodeGraphDataFrameFieldNames.target},{name:r.NodeGraphDataFrameFieldNames.mainStat,config:{unit:"r",displayName:"Requests"}},{name:r.NodeGraphDataFrameFieldNames.secondaryStat,config:{unit:"ms/r",displayName:"Average response time"}}]);return[t,n]}();for(const t of Object.keys(e)){const n=e[t];o.add({[r.NodeGraphDataFrameFieldNames.id]:t,[r.NodeGraphDataFrameFieldNames.title]:t,[r.NodeGraphDataFrameFieldNames.mainStat]:n.total?n.seconds/n.total*1e3:Number.NaN,[r.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?Math.round(n.total/(a/1e3)*100)/100:Number.NaN,[r.NodeGraphDataFrameFieldNames.arc+"success"]:n.total?(n.total-(n.failed||0))/n.total:1,[r.NodeGraphDataFrameFieldNames.arc+"failed"]:n.total?(n.failed||0)/n.total:0})}for(const e of Object.keys(t)){const n=t[e];i.add({[r.NodeGraphDataFrameFieldNames.id]:e,[r.NodeGraphDataFrameFieldNames.source]:n.source,[r.NodeGraphDataFrameFieldNames.target]:n.target,[r.NodeGraphDataFrameFieldNames.mainStat]:n.total,[r.NodeGraphDataFrameFieldNames.secondaryStat]:n.total?n.seconds/n.total*1e3:Number.NaN})}return{nodes:o,edges:i}}(a,o,t)}function p(e,t,n,r,a){if(!e)return;const o=`Value #${n}`;for(let n=0;n<e.length;n++){const i=e.get(n),s=`${i.client}_${i.server}`;a[s]?a[s][t]=(a[s][t]||0)+i[o]:a[s]={target:i.server,source:i.client,[t]:i[o]},r[i.server]?r[i.server][t]=(r[i.server][t]||0)+i[o]:r[i.server]={[t]:i[o]},r[i.client]||(r[i.client]={[t]:0})}}},"./public/app/plugins/datasource/tempo/resultTransformer.ts":(e,t,n)=>{n.d(t,{n4:()=>Ke,IM:()=>ke,g9:()=>Be,Jk:()=>je,RY:()=>Fe});var r=n("./packages/grafana-data/src/index.ts"),a=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),a=0,o=t;a<o.length;a++){var i=o[a];r._entries.delete(i)}return r},e.prototype.clear=function(){return new e},e}();Symbol("BaggageEntryMetadata");function o(e){return void 0===e&&(e={}),new a(new Map(Object.entries(e)))}var i;!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(i||(i={}));var s={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},u={set:function(e,t,n){null!=e&&(e[t]=n)}};function c(e){return Symbol.for(e)}var l,p=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var a=new e(n._currentContext);return a._currentContext.set(t,r),a},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},d=new p;!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(l||(l={}));var f=/^([0-9a-f]{32})$/i,m=/^[0-9a-f]{16}$/i,g="0000000000000000",N="00000000000000000000000000000000",v={traceId:N,spanId:g,traceFlags:l.NONE};function h(e){return n=e.traceId,f.test(n)&&n!==N&&(t=e.spanId,m.test(t)&&t!==g);var t,n}function E(e){return new y(e)}var y=function(){function e(e){void 0===e&&(e=v),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),_=c("OpenTelemetry Context Key SPAN");function D(e){return e.getValue(_)||void 0}function A(e,t){return e.setValue(_,t)}function S(e){return e.deleteValue(_)}function T(e,t){return A(e,new y(t))}function b(e){var t;return null===(t=D(e))||void 0===t?void 0:t.spanContext()}var I=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new y;var r,a=n&&b(n);return"object"==typeof(r=a)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&h(a)?new y(a):new y},e.prototype.startActiveSpan=function(e,t,n,r){var a,o,i;if(!(arguments.length<2)){2===arguments.length?i=t:3===arguments.length?(a=t,i=n):(a=t,o=n,i=r);var s=null!=o?o:le.active(),u=this.startSpan(e,a,s),c=A(s,u);return le.with(c,i,void 0,u)}},e}();var R,C,O,F=new I,L=function(){function e(e,t,n){this._provider=e,this.name=t,this.version=n}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version);return e?(this._delegate=e,this._delegate):F},e}(),w=new(function(){function e(){}return e.prototype.getTracer=function(e,t){return new I},e}()),P=function(){function e(){}return e.prototype.getTracer=function(e,t){var n;return null!==(n=this.getDelegateTracer(e,t))&&void 0!==n?n:new L(this,e,t)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:w},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(R||(R={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(C||(C={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(O||(O={}));var U=function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e},G=function(){function e(){}return e.prototype.active=function(){return d},e.prototype.with=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];return t.call.apply(t,U([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),M="object"==typeof globalThis?globalThis:window,k="1.0.2",B=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var V=function(e){var t=new Set([e]),n=new Set,r=e.match(B);if(!r)return function(){return!1};var a=+r[1],o=+r[2],i=+r[3];if(null!=r[4])return function(t){return t===e};function s(e){return n.add(e),!1}function u(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(B);if(!r)return s(e);var c=+r[1],l=+r[2],p=+r[3];return null!=r[4]||a!==c?s(e):0===a?o===l&&i<=p?u(e):s(e):o<=l?u(e):s(e)}}(k),x=k.split(".")[0],H=Symbol.for("opentelemetry.js.api."+x),q=M;function W(e,t,n,r){var a;void 0===r&&(r=!1);var o=q[H]=null!==(a=q[H])&&void 0!==a?a:{version:k};if(!r&&o[e]){var i=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(i.stack||i.message),!1}if(o.version!==k){i=new Error("@opentelemetry/api: All API registration versions must match");return n.error(i.stack||i.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+"1.0.2."),!0}function j(e){var t,n,r=null===(t=q[H])||void 0===t?void 0:t.version;if(r&&V(r))return null===(n=q[H])||void 0===n?void 0:n[e]}function K(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+"1.0.2.");var n=q[H];n&&delete n[e]}var X=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Y("verbose",this._namespace,e)},e}();function Y(e,t,n){var r=j("diag");if(r)return n.unshift(t),r[e].apply(r,n)}var Q=function(){function e(){function e(e){return function(){var t=j("diag");if(t)return t[e].apply(t,arguments)}}var t=this;t.setLogger=function(e,n){var r,a;if(void 0===n&&(n=i.INFO),e===t){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=o.stack)&&void 0!==r?r:o.message),!1}var s=j("diag"),u=function(e,t){function n(n,r){var a=t[n];return"function"==typeof a&&e>=r?a.bind(t):function(){}}return e<i.NONE?e=i.NONE:e>i.ALL&&(e=i.ALL),t=t||{},{error:n("error",i.ERROR),warn:n("warn",i.WARN),info:n("info",i.INFO),debug:n("debug",i.DEBUG),verbose:n("verbose",i.VERBOSE)}}(n,e);if(s){var c=null!==(a=(new Error).stack)&&void 0!==a?a:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+c),u.warn("Current logger will overwrite one already registered from "+c)}return W("diag",u,t,!0)},t.disable=function(){K("diag",t)},t.createComponentLogger=function(e){return new X(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),z=function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e},Z="context",$=new G,J=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return W(Z,e,Q.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,z([e,t,n],a))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return j(Z)||$},e.prototype.disable=function(){this._getContextManager().disable(),K(Z,Q.instance())},e}(),ee="trace",te=function(){function e(){this._proxyTracerProvider=new P,this.wrapSpanContext=E,this.isSpanContextValid=h,this.deleteSpan=S,this.getSpan=D,this.getSpanContext=b,this.setSpan=A,this.setSpanContext=T}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=W(ee,this._proxyTracerProvider,Q.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return j(ee)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){K(ee,Q.instance()),this._proxyTracerProvider=new P},e}(),ne=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),re=c("OpenTelemetry Baggage Key");function ae(e){return e.getValue(re)||void 0}function oe(e,t){return e.setValue(re,t)}function ie(e){return e.deleteValue(re)}var se="propagation",ue=new ne,ce=function(){function e(){this.createBaggage=o,this.getBaggage=ae,this.setBaggage=oe,this.deleteBaggage=ie}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return W(se,e,Q.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=u),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=s),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){K(se,Q.instance())},e.prototype._getGlobalPropagator=function(){return j(se)||ue},e}(),le=J.getInstance();te.getInstance(),ce.getInstance(),Q.instance();var pe,de,fe,me,ge,Ne,ve,he,Ee,ye,_e,De;!function(e){e.OTHER_SQL="other_sql",e.MSSQL="mssql",e.MYSQL="mysql",e.ORACLE="oracle",e.DB2="db2",e.POSTGRESQL="postgresql",e.REDSHIFT="redshift",e.HIVE="hive",e.CLOUDSCAPE="cloudscape",e.HSQLDB="hsqldb",e.PROGRESS="progress",e.MAXDB="maxdb",e.HANADB="hanadb",e.INGRES="ingres",e.FIRSTSQL="firstsql",e.EDB="edb",e.CACHE="cache",e.ADABAS="adabas",e.FIREBIRD="firebird",e.DERBY="derby",e.FILEMAKER="filemaker",e.INFORMIX="informix",e.INSTANTDB="instantdb",e.INTERBASE="interbase",e.MARIADB="mariadb",e.NETEZZA="netezza",e.PERVASIVE="pervasive",e.POINTBASE="pointbase",e.SQLITE="sqlite",e.SYBASE="sybase",e.TERADATA="teradata",e.VERTICA="vertica",e.H2="h2",e.COLDFUSION="coldfusion",e.CASSANDRA="cassandra",e.HBASE="hbase",e.MONGODB="mongodb",e.REDIS="redis",e.COUCHBASE="couchbase",e.COUCHDB="couchdb",e.COSMOSDB="cosmosdb",e.DYNAMODB="dynamodb",e.NEO4J="neo4j",e.GEODE="geode",e.ELASTICSEARCH="elasticsearch",e.MEMCACHED="memcached",e.COCKROACHDB="cockroachdb"}(pe||(pe={})),function(e){e.ALL="all",e.EACH_QUORUM="each_quorum",e.QUORUM="quorum",e.LOCAL_QUORUM="local_quorum",e.ONE="one",e.TWO="two",e.THREE="three",e.LOCAL_ONE="local_one",e.ANY="any",e.SERIAL="serial",e.LOCAL_SERIAL="local_serial"}(de||(de={})),function(e){e.DATASOURCE="datasource",e.HTTP="http",e.PUBSUB="pubsub",e.TIMER="timer",e.OTHER="other"}(fe||(fe={})),function(e){e.INSERT="insert",e.EDIT="edit",e.DELETE="delete"}(me||(me={})),function(e){e.ALIBABA_CLOUD="alibaba_cloud",e.AWS="aws",e.AZURE="azure",e.GCP="gcp"}(ge||(ge={})),function(e){e.IP_TCP="ip_tcp",e.IP_UDP="ip_udp",e.IP="ip",e.UNIX="unix",e.PIPE="pipe",e.INPROC="inproc",e.OTHER="other"}(Ne||(Ne={})),function(e){e.WIFI="wifi",e.WIRED="wired",e.CELL="cell",e.UNAVAILABLE="unavailable",e.UNKNOWN="unknown"}(ve||(ve={})),function(e){e.GPRS="gprs",e.EDGE="edge",e.UMTS="umts",e.CDMA="cdma",e.EVDO_0="evdo_0",e.EVDO_A="evdo_a",e.CDMA2000_1XRTT="cdma2000_1xrtt",e.HSDPA="hsdpa",e.HSUPA="hsupa",e.HSPA="hspa",e.IDEN="iden",e.EVDO_B="evdo_b",e.LTE="lte",e.EHRPD="ehrpd",e.HSPAP="hspap",e.GSM="gsm",e.TD_SCDMA="td_scdma",e.IWLAN="iwlan",e.NR="nr",e.NRNSA="nrnsa",e.LTE_CA="lte_ca"}(he||(he={})),function(e){e.HTTP_1_0="1.0",e.HTTP_1_1="1.1",e.HTTP_2_0="2.0",e.SPDY="SPDY",e.QUIC="QUIC"}(Ee||(Ee={})),function(e){e.QUEUE="queue",e.TOPIC="topic"}(ye||(ye={})),function(e){e.RECEIVE="receive",e.PROCESS="process"}(_e||(_e={})),function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(De||(De={}));var Ae,Se,Te,be,Ie,Re,Ce="service.name";!function(e){e.ALIBABA_CLOUD="alibaba_cloud",e.AWS="aws",e.AZURE="azure",e.GCP="gcp"}(Ae||(Ae={})),function(e){e.ALIBABA_CLOUD_ECS="alibaba_cloud_ecs",e.ALIBABA_CLOUD_FC="alibaba_cloud_fc",e.AWS_EC2="aws_ec2",e.AWS_ECS="aws_ecs",e.AWS_EKS="aws_eks",e.AWS_LAMBDA="aws_lambda",e.AWS_ELASTIC_BEANSTALK="aws_elastic_beanstalk",e.AZURE_VM="azure_vm",e.AZURE_CONTAINER_INSTANCES="azure_container_instances",e.AZURE_AKS="azure_aks",e.AZURE_FUNCTIONS="azure_functions",e.AZURE_APP_SERVICE="azure_app_service",e.GCP_COMPUTE_ENGINE="gcp_compute_engine",e.GCP_CLOUD_RUN="gcp_cloud_run",e.GCP_KUBERNETES_ENGINE="gcp_kubernetes_engine",e.GCP_CLOUD_FUNCTIONS="gcp_cloud_functions",e.GCP_APP_ENGINE="gcp_app_engine"}(Se||(Se={})),function(e){e.EC2="ec2",e.FARGATE="fargate"}(Te||(Te={})),function(e){e.AMD64="amd64",e.ARM32="arm32",e.ARM64="arm64",e.IA64="ia64",e.PPC32="ppc32",e.PPC64="ppc64",e.X86="x86"}(be||(be={})),function(e){e.WINDOWS="windows",e.LINUX="linux",e.DARWIN="darwin",e.FREEBSD="freebsd",e.NETBSD="netbsd",e.OPENBSD="openbsd",e.DRAGONFLYBSD="dragonflybsd",e.HPUX="hpux",e.AIX="aix",e.SOLARIS="solaris",e.Z_OS="z_os"}(Ie||(Ie={})),function(e){e.CPP="cpp",e.DOTNET="dotnet",e.ERLANG="erlang",e.GO="go",e.JAVA="java",e.NODEJS="nodejs",e.PHP="php",e.PYTHON="python",e.RUBY="ruby",e.WEBJS="webjs"}(Re||(Re={}));var Oe=n("./public/app/plugins/datasource/tempo/graphTransform.ts");function Fe(e,t,n,a){return e.data.forEach(((o,i)=>{const s=function(e,t,n,a){const o=new r.MutableDataFrame({fields:[{name:"Time",type:r.FieldType.time,config:{custom:{width:150}}},{name:"traceID",type:r.FieldType.string,config:{displayNameFromDS:"Trace ID",custom:{width:300},links:[{title:"Click to open trace ${__value.raw}",url:"",internal:{datasourceUid:t,datasourceName:n,query:{query:"${__value.raw}"}}}]}},{name:"Message",type:r.FieldType.string}],meta:{preferredVisualisationType:"table"}});if(!e||0===a.length)return o;const i=e.fields.find((e=>e.type===r.FieldType.time));for(let t of e.fields){let e=!1;if(t.type===r.FieldType.string){const n=t.values.toArray();for(let t=0;t<n.length;t++){const r=n[t];if(r)for(let n of a){const a=r.match(n);if(a){const n=a[1],s=i?i.values.get(t):null;o.fields[0].values.add(s),o.fields[1].values.add(n),o.fields[2].values.add(r),e=!0}}}}if(e)break}return o}(o,t,n,a);e.data[i]=s})),e}function Le(e){const t=atob(e);let n="";for(let e=0;e<t.length;e++){const r=t.charCodeAt(e).toString(16);n+=2===r.length?r:"0"+r}return n.length>16?n.slice(16):n}function we(e){const t=e.match(/\w{2}/g)||[];return btoa(t.map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))}function Pe(e){if(e.stringValue)return e.stringValue;if(void 0!==e.boolValue)return Boolean(e.boolValue);if(void 0!==e.intValue)return Number.parseInt(e.intValue,10);if(e.doubleValue)return Number.parseFloat(e.doubleValue);if(e.arrayValue){const t=[];for(const n of e.arrayValue.values)t.push(Pe(n));return t}return""}function Ue(e){const t=[];let n="OTLPResourceNoServiceName";if(!e)return{serviceName:n,serviceTags:t};for(const r of e.attributes)r.key===Ce&&(n=r.value.stringValue||n),t.push({key:r.key,value:Pe(r.value)});return{serviceName:n,serviceTags:t}}function Ge(e,t){const n=[];if(t&&(t.name&&n.push({key:"otel.library.name",value:t.name}),t.version&&n.push({key:"otel.library.version",value:t.version})),e.attributes)for(const t of e.attributes)n.push({key:t.key,value:Pe(t.value)});if(e.status&&(e.status.code&&e.status.code!==O.UNSET&&(n.push({key:"otel.status_code",value:O[e.status.code]}),e.status.message&&n.push({key:"otel.status_description",value:e.status.message})),e.status.code===O.ERROR&&n.push({key:"error",value:!0})),void 0!==e.kind){const t=e.kind.toString().toLowerCase().split("_");n.push({key:"span.kind",value:t.length?t[t.length-1]:e.kind.toString()})}return n}function Me(e){const t=[];if(e.events)for(const n of e.events){const e=[];if(n.attributes)for(const t of n.attributes)e.push({key:t.key,value:Pe(t.value)});t.push({fields:e,timestamp:n.timeUnixNano/1e6})}return t}function ke(e,t=!1){const n=new r.MutableDataFrame({fields:[{name:"traceID",type:r.FieldType.string},{name:"spanID",type:r.FieldType.string},{name:"parentSpanID",type:r.FieldType.string},{name:"operationName",type:r.FieldType.string},{name:"serviceName",type:r.FieldType.string},{name:"serviceTags",type:r.FieldType.other},{name:"startTime",type:r.FieldType.number},{name:"duration",type:r.FieldType.number},{name:"logs",type:r.FieldType.other},{name:"tags",type:r.FieldType.other}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}});try{for(const t of e){const{serviceName:e,serviceTags:r}=Ue(t.resource);for(const a of t.instrumentationLibrarySpans)for(const t of a.spans)n.add({traceID:Le(t.traceId),spanID:Le(t.spanId),parentSpanID:Le(t.parentSpanId||""),operationName:t.name||"",serviceName:e,serviceTags:r,startTime:t.startTimeUnixNano/1e6,duration:(t.endTimeUnixNano-t.startTimeUnixNano)/1e6,tags:Ge(t,a.instrumentationLibrary),logs:Me(t)})}}catch(e){return console.error(e),{error:{message:"JSON is not valid OpenTelemetry format: "+e},data:[]}}let a=[n];return t&&a.push(...(0,Oe.M7)(n)),{data:a}}function Be(e){let t={batches:[]},n={};for(let o=0;o<e.length;o++){const i=e.get(o);n[i.serviceName]||(n[i.serviceName]=t.batches.length,t.batches.push({resource:{attributes:[],droppedAttributesCount:0},instrumentationLibrarySpans:[{spans:[]}]}));let s=n[i.serviceName];if(0===t.batches[s].resource.attributes.length&&(t.batches[s].resource.attributes=xe(i.serviceTags)),!t.batches[s].instrumentationLibrarySpans[0].instrumentationLibrary){var r;let e=null===(r=i.tags.find((e=>"otel.library.name"===e.key)))||void 0===r?void 0:r.value;var a;if(e)t.batches[s].instrumentationLibrarySpans[0].instrumentationLibrary={name:e,version:null===(a=i.tags.find((e=>"otel.library.version"===e.key)))||void 0===a?void 0:a.value}}t.batches[s].instrumentationLibrarySpans[0].spans.push({traceId:we(i.traceID.padStart(32,"0")),spanId:we(i.spanID),traceState:"",parentSpanId:we(i.parentSpanID||""),name:i.operationName,kind:Ve(i.tags),startTimeUnixNano:1e6*i.startTime,endTimeUnixNano:1e6*(i.startTime+i.duration),attributes:xe(i.tags),droppedAttributesCount:0,droppedEventsCount:0,droppedLinksCount:0,status:qe(i.tags),events:We(i.logs)})}return t}function Ve(e){var t;let n;switch(null===(t=e.find((e=>"span.kind"===e.key)))||void 0===t?void 0:t.value){case"server":n="SPAN_KIND_SERVER";break;case"client":n="SPAN_KIND_CLIENT";break;case"producer":n="SPAN_KIND_PRODUCER";break;case"consumer":n="SPAN_KIND_CONSUMER"}return n}function xe(e){return e.filter((e=>!["span.kind","otel.library.name","otel.libary.version","otel.status_description","otel.status_code"].includes(e.key))).reduce(((e,t)=>[...e,{key:t.key,value:He(t)}]),[])}function He(e){if("string"==typeof e.value)return{stringValue:e.value};if("boolean"==typeof e.value)return{boolValue:e.value};if("number"==typeof e.value)return e.value%1==0?{intValue:e.value}:{doubleValue:e.value};if("object"==typeof e.value&&Array.isArray(e.value)){const t=[];for(const n of e.value)t.push(He(n));return{arrayValue:{values:t}}}return{stringValue:e.value}}function qe(e){let t;const n=e.find((e=>"otel.status_code"===e.key));var r;n&&(t={code:n.value,message:null===(r=e.find((e=>"otel_status_description"===e.key)))||void 0===r?void 0:r.value});return t}function We(e){if(!e||!e.length)return;let t=[];for(const n of e){let e={timeUnixNano:1e6*n.timestamp,attributes:[],droppedAttributesCount:0,name:""};for(const t of n.fields)e.attributes.push({key:t.key,value:He(t)});t.push(e)}return t}function je(e,t=!1){const n=e.data[0];if(!n)return Ye;!function(e){for(const t of["serviceTags","logs","tags"]){const n=e.fields.find((e=>e.name===t));if(n){const t=e.fields.indexOf(n),a=new r.ArrayVector,o=Object.assign({},n,{values:a,type:r.FieldType.other});for(let e=0;e<n.values.length;e++){const t=n.values.get(e);a.set(e,""===t?void 0:JSON.parse(t))}e.fields[t]=o}}}(n);let a=[...e.data];return t&&a.push(...(0,Oe.M7)(n)),Object.assign({},e,{data:a})}function Ke(e,t){const n=new r.MutableDataFrame({fields:[{name:"traceID",type:r.FieldType.string,config:{displayNameFromDS:"Trace ID",links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:{query:"${__value.raw}",queryType:"traceId"}}}]}},{name:"traceName",type:r.FieldType.string,config:{displayNameFromDS:"Trace name"}},{name:"startTime",type:r.FieldType.time,config:{displayNameFromDS:"Start time"}},{name:"duration",type:r.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms"}}],meta:{preferredVisualisationType:"table"}});if(null==e||!e.length)return n;const a=e.map(Xe).sort(((e,t)=>(null==t?void 0:t.startTime)-(null==e?void 0:e.startTime)));for(const e of a)n.add(e);return n}function Xe(e){let t="";return e.rootServiceName&&(t+=e.rootServiceName+" "),e.rootTraceName&&(t+=e.rootTraceName),{traceID:e.traceID,startTime:parseInt(e.startTimeUnixNano,10)/1e3/1e3,duration:e.durationMs,traceName:t}}const Ye={data:[new r.MutableDataFrame({fields:[{name:"trace",type:r.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}})]}}}]);
//# sourceMappingURL=5234.787ecc600122eb73aeab.js.map