"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2461,4286],{"./public/app/core/hooks/useCleanup.ts":(e,a,s)=>{s.d(a,{x:()=>i});var t=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=s("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),n=s("./public/app/core/actions/cleanUp.ts");function i(e){const a=(0,r.useDispatch)(),s=(0,t.useRef)(e);s.current=e,(0,t.useEffect)((()=>()=>{a((0,n.e)({stateSelector:s.current}))}),[a])}},"./public/app/core/hooks/useQueryParams.ts":(e,a,s)=>{s.d(a,{K:()=>i});var t=s("./packages/grafana-runtime/src/index.ts"),r=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=s("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js");function i(){const{search:e}=(0,n.TH)();return[(0,r.useMemo)((()=>(0,t.locationSearchToObject)(e||"")),[e]),(0,r.useCallback)(((e,a)=>t.locationService.partial(e,a)),[])]}},"./public/app/features/alerting/AlertRuleList.tsx":(e,a,s)=>{s.r(a),s.d(a,{AlertRuleListUnconnected:()=>T,default:()=>I});var t=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=s("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),n=s("./public/app/core/components/Page/Page.tsx"),i=s("./.yarn/__virtual__/react-highlight-words-virtual-d2265e757c/0/cache/react-highlight-words-npm-0.17.0-880b4a18ed-41b3d0e451.zip/node_modules/react-highlight-words/dist/main.js"),l=s.n(i),o=s("./packages/grafana-ui/src/index.ts"),c=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const u=e=>{let{rule:a,search:s,onTogglePause:r}=e;const n=`${a.url}?editPanel=${a.panelId}&tab=alert`,i=(0,t.useCallback)((e=>(0,c.jsx)(l(),{highlightClassName:"highlight-search-match",textToHighlight:e,searchWords:[s]},e)),[s]);return(0,c.jsxs)(o.Card,{heading:(0,c.jsx)("a",{href:n,children:i(a.name)}),children:[(0,c.jsx)(o.Card.Figure,{children:(0,c.jsx)(o.Icon,{size:"xl",name:a.stateIcon,className:`alert-rule-item__icon ${a.stateClass}`})}),(0,c.jsxs)(o.Card.Meta,{children:[(0,c.jsxs)("span",{children:[(0,c.jsxs)("span",{className:`${a.stateClass}`,children:[i(a.stateText)," "]},"text"),"for ",a.stateAge]},"state"),a.info?i(a.info):null]}),(0,c.jsxs)(o.Card.Actions,{children:[(0,c.jsx)(o.Button,{variant:"secondary",icon:"paused"===a.state?"play":"pause",onClick:r,children:"paused"===a.state?"Resume":"Pause"},"play"),(0,c.jsx)(o.LinkButton,{variant:"secondary",href:n,icon:"cog",children:"Edit alert"},"edit")]})]})};var d=s("./public/app/core/app_events.ts"),p=s("./public/app/core/selectors/navModel.ts"),m=s("./public/app/features/alerting/state/actions.ts");const g=e=>e.searchQuery,h=e=>{const a=new RegExp(e.alertRules.searchQuery,"i");return e.alertRules.items.filter((e=>a.test(e.name)||a.test(e.stateText)||a.test(e.info)))};var x,f=s("./packages/grafana-runtime/src/index.ts"),v=s("./public/app/features/alerting/state/reducers.ts"),b=s("./public/app/types/events.ts");function j(e){let{onDismiss:a}=e;return(0,c.jsx)(o.Modal,{title:"Adding an Alert",isOpen:!0,onDismiss:a,onClickBackdrop:a,children:x||(x=(0,c.jsxs)(o.VerticalGroup,{spacing:"sm",children:[(0,c.jsx)("img",{src:"public/img/alert_howto_new.png",alt:"link to how to alert image"}),(0,c.jsx)("p",{children:"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."}),(0,c.jsx)("p",{children:"Remember to save the dashboard to persist your alert rule changes."})]}))})}var y,S,_=s("./.yarn/__virtual__/react-use-virtual-ca2705900f/0/cache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useLocalStorage.js");const w=()=>{const[e,a]=(0,_.Z)("grafana.legacyalerting.unifiedalertingpromo",!0);return e?(0,c.jsxs)(o.Alert,{severity:"info",title:"Try out the Grafana 8 alerting!",onRemove:()=>a(!1),children:[y||(y=(0,c.jsxs)("p",{children:["You are using the legacy Grafana alerting.",(0,c.jsx)("br",{}),"While we have no plans of deprecating it any time soon, we invite you to give the improved Grafana 8 alerting a try."]})),S||(S=(0,c.jsxs)("p",{children:["See"," ",(0,c.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/difference-old-new/",children:"What’s New with Grafana 8 alerting"})," ","to learn more about what‘s new in Grafana 8 alerting or learn"," ",(0,c.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/opt-in/",children:"how to enable the new Grafana 8 alerting feature"}),"."]}))]}):null};var C,N,R,k;function $(e,a,s){return a in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,e}const A={getAlertRulesAsync:m.Au,setSearchQuery:v.ql,togglePauseAlertRule:m.en},F=(0,r.connect)((function(e){return{navModel:(0,p.h)(e.navIndex,"alert-list"),alertRules:h(e),search:g(e.alertRules),isLoading:e.alertRules.isLoading}}),A);class T extends t.PureComponent{constructor(){super(...arguments),$(this,"stateFilters",[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}]),$(this,"onStateFilterChanged",(e=>{f.locationService.partial({state:e.value})})),$(this,"onOpenHowTo",(()=>{d.Z.publish(new b.Dn({component:j}))})),$(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),$(this,"onTogglePause",(e=>{this.props.togglePauseAlertRule(e.id,{paused:"paused"!==e.state})})),$(this,"alertStateFilterOption",(e=>{let{text:a,value:s}=e;return(0,c.jsx)("option",{value:s,children:a},s)}))}componentDidMount(){this.fetchRules()}componentDidUpdate(e){e.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){var e;return null!==(e=this.props.queryParams.state)&&void 0!==e?e:"all"}render(){const{navModel:e,alertRules:a,search:s,isLoading:t}=this.props;return(0,c.jsx)(n.Z,{navModel:e,children:(0,c.jsxs)(n.Z.Contents,{isLoading:t,children:[(0,c.jsxs)("div",{className:"page-action-bar",children:[(0,c.jsx)("div",{className:"gf-form gf-form--grow",children:(0,c.jsx)(o.FilterInput,{placeholder:"Search alerts",value:s,onChange:this.onSearchQueryChange})}),(0,c.jsxs)("div",{className:"gf-form",children:[C||(C=(0,c.jsx)("label",{className:"gf-form-label",htmlFor:"alert-state-filter",children:"States"})),(0,c.jsx)("div",{className:"width-13",children:(0,c.jsx)(o.Select,{inputId:"alert-state-filter",menuShouldPortal:!0,options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()})})]}),N||(N=(0,c.jsx)("div",{className:"page-action-bar__spacer"})),f.config.unifiedAlertingEnabled&&(R||(R=(0,c.jsx)(o.LinkButton,{variant:"primary",href:"alerting/ng/new",children:"Add NG Alert"}))),(0,c.jsx)(o.Button,{variant:"secondary",onClick:this.onOpenHowTo,children:"How to add an alert"})]}),k||(k=(0,c.jsx)(w,{})),(0,c.jsx)(o.VerticalGroup,{spacing:"none",children:a.map((e=>(0,c.jsx)(u,{rule:e,search:s,onTogglePause:()=>this.onTogglePause(e)},e.id)))})]})})}}const I=F(T)},"./public/app/features/alerting/AlertRuleListIndex.tsx":(e,a,s)=>{s.r(a),s.d(a,{default:()=>Fe});var t,r,n=s("./packages/grafana-runtime/src/index.ts"),i=s("./packages/grafana-data/src/index.ts"),l=s("./packages/grafana-ui/src/index.ts"),o=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),c=s("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),u=s("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),d=s("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),p=s("./public/app/core/services/context_srv.ts"),m=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const g=()=>p.Vt.hasEditPermissionInFolders||p.Vt.isEditor?t||(t=(0,m.jsx)(d.Z,{title:"You haven`t created any alert rules yet",buttonIcon:"bell",buttonLink:"alerting/new",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank"})):r||(r=(0,m.jsx)(l.CallToActionCard,{message:"No rules exist yet.",callToActionElement:(0,m.jsx)("div",{})}));var h=s("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),x=s("./public/app/features/alerting/unified/utils/datasource.ts"),f=s("./public/app/features/alerting/unified/utils/rules.ts"),v=s("./public/app/features/alerting/unified/utils/misc.ts"),b=s("./public/app/core/hooks/useQueryParams.ts"),j=s("./public/app/types/unified-alerting-dto.ts"),y=s("./public/app/features/alerting/unified/utils/alertmanager.ts");const S=e=>(a,s)=>{const t=s.groups.reduce(_(e),[]);return t.length&&a.push(Object.assign({},s,{groups:t})),a},_=e=>(a,s)=>{const t=s.rules.filter((a=>{var s;if(e.ruleType&&e.ruleType!==(null===(s=a.promRule)||void 0===s?void 0:s.type))return!1;if(e.dataSource&&(0,f.Pc)(a.rulerRule)&&!w(a.rulerRule,e))return!1;if(e.queryString){var t;const s=e.queryString.toLocaleLowerCase(),r=null===(t=a.name)||void 0===t?void 0:t.toLocaleLowerCase().includes(s),n=(0,y.Zh)(e.queryString),i=(0,y.eD)(a.labels,n),l=a.promRule&&a.promRule.type===j.pz.Alerting&&a.promRule.alerts&&a.promRule.alerts.some((e=>(0,y.eD)(e.labels,n)));if(!(r||i||l))return!1}return!!(!e.alertState||a.promRule&&(0,f.x_)(a.promRule)&&a.promRule.state===e.alertState)}));return t.length&&a.push(Object.assign({},s,{rules:t})),a},w=(e,a)=>!a.dataSource||!!e.grafana_alert.data.find((e=>{if(!e.datasourceUid)return!1;const s=(0,n.getDataSourceSrv)().getInstanceSettings(e.datasourceUid);return(null==s?void 0:s.name)===a.dataSource}));var C,N,R,k,$,A,F=s("./public/app/features/alerting/unified/state/actions.ts"),T=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),I=s("./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts"),z=s("./public/app/features/alerting/unified/utils/constants.ts"),P=s("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");const E=[{icon:"folder",label:"Groups",value:"group"},{icon:"heart-rate",label:"State",value:"state"}],G=[{label:"Alert ",value:j.pz.Alerting},{label:"Recording ",value:j.pz.Recording}],L=e=>({container:T.css`
      display: flex;
      flex-direction: column;
      border-bottom: 1px solid ${e.colors.border1};
      padding-bottom: ${e.spacing.sm};

      & > div {
        margin-bottom: ${e.spacing.sm};
      }
    `,inputWidth:T.css`
      width: 340px;
      flex-grow: 0;
    `,flexRow:T.css`
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      width: 100%;
      flex-wrap: wrap;
    `,spaceBetween:T.css`
      justify-content: space-between;
    `,rowChild:T.css`
      margin-right: ${e.spacing.sm};
      margin-top: ${e.spacing.sm};
    `,tooltip:T.css`
      margin: 0 ${e.spacing.xs};
    `,clearButton:T.css`
      margin-top: ${e.spacing.sm};
    `}),O=()=>{const[e,a]=(0,b.K)(),[s,t]=(0,o.useState)(Math.floor(100*Math.random())),r=`dataSource-${s}`,i=`queryString-${s}`,{dataSource:c,alertState:u,queryString:d,ruleType:p}=(0,v.lC)(e),g=(0,l.useStyles)(L),h=Object.entries(j.x_).map((e=>{let[a,s]=e;return{label:(0,f.SS)(s),value:s}})),x=(0,P.debounce)((e=>{const s=e.target;a({queryString:s.value||null})}),600),y=C||(C=(0,m.jsx)(l.Icon,{name:"search"}));return(0,m.jsxs)("div",{className:g.container,children:[(0,m.jsxs)("div",{className:g.inputWidth,children:[N||(N=(0,m.jsx)(l.Label,{children:"Search by data source"})),(0,m.jsx)(n.DataSourcePicker,{alerting:!0,noDefault:!0,placeholder:"All data sources",current:c,onChange:e=>{a({dataSource:e.name})},onClear:()=>{a({dataSource:null})}},r)]}),(0,m.jsxs)("div",{className:(0,T.cx)(g.flexRow,g.spaceBetween),children:[(0,m.jsxs)("div",{className:g.flexRow,children:[(0,m.jsxs)("div",{className:g.rowChild,children:[(0,m.jsxs)(l.Label,{children:[(0,m.jsx)(l.Tooltip,{content:R||(R=(0,m.jsxs)("div",{children:["Filter rules and alerts using label querying, ex:",(0,m.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'})]})),children:(0,m.jsx)(l.Icon,{name:"info-circle",className:g.tooltip})}),"Search by label"]}),(0,m.jsx)(l.Input,{className:g.inputWidth,prefix:y,onChange:x,defaultValue:d,placeholder:"Search","data-testid":"search-query-input"},i)]}),(0,m.jsxs)("div",{className:g.rowChild,children:[k||(k=(0,m.jsx)(l.Label,{children:"State"})),(0,m.jsx)(l.RadioButtonGroup,{options:h,value:u,onChange:e=>{a({alertState:e})}})]}),(0,m.jsxs)("div",{className:g.rowChild,children:[$||($=(0,m.jsx)(l.Label,{children:"Rule type"})),(0,m.jsx)(l.RadioButtonGroup,{options:G,value:p,onChange:e=>{a({ruleType:e})}})]}),(0,m.jsxs)("div",{className:g.rowChild,children:[A||(A=(0,m.jsx)(l.Label,{children:"View as"})),(0,m.jsx)(l.RadioButtonGroup,{options:E,value:String(e.view||"group"),onChange:e=>{a({view:e})}})]})]}),(c||u||d||p)&&(0,m.jsx)("div",{className:g.flexRow,children:(0,m.jsx)(l.Button,{className:g.clearButton,fullWidth:!1,icon:"times",variant:"secondary",onClick:()=>{a({alertState:null,queryString:null,dataSource:null,ruleType:null}),setTimeout((()=>t(s+1)),100)},children:"Clear filters"})})]})]})};var B=s("./public/app/features/alerting/unified/components/CollapseToggle.tsx"),M=s("./public/app/features/alerting/unified/components/rules/RulesTable.tsx"),q=s("./public/app/features/alerting/unified/components/rules/ActionIcon.tsx"),D=s("./public/app/features/alerting/unified/hooks/useHasRuler.ts"),H=s("./public/app/core/utils/kbn.ts"),U=s("./public/app/features/alerting/unified/hooks/useFolder.ts"),W=s("./.yarn/cache/pluralize-npm-8.0.0-f5f044ed52-08931d4a6a.zip/node_modules/pluralize/pluralize.js"),V=s.n(W);const Z=e=>{let{children:a,status:s}=e;const t=(0,l.useStyles2)(K);return(0,m.jsx)("span",{className:t[s],children:a||s})},K=e=>({[j.x_.Inactive]:T.css`
    color: ${e.colors.success.text};
  `,[j.x_.Pending]:T.css`
    color: ${e.colors.warning.text};
  `,[j.x_.Firing]:T.css`
    color: ${e.colors.error.text};
  `,neutral:T.css`
    color: ${e.colors.text.secondary};
  `});var Q,J;const Y={total:0,recording:0,[j.x_.Firing]:0,[j.x_.Pending]:0,[j.x_.Inactive]:0,error:0},X=e=>{let{showInactive:a,showRecording:s,group:t,namespaces:r}=e;const n=(0,o.useMemo)((()=>{const e=Object.assign({},Y),a=a=>{var s,t;a.promRule&&(0,f.x_)(a.promRule)&&(e[a.promRule.state]+=1),"err"!==(null===(s=a.promRule)||void 0===s?void 0:s.health)&&"error"!==(null===(t=a.promRule)||void 0===t?void 0:t.health)||(e.error+=1),(a.promRule&&(0,f.OP)(a.promRule)||a.rulerRule&&(0,f.yF)(a.rulerRule))&&(e.recording+=1),e.total+=1};return t&&t.rules.forEach(a),r&&r.forEach((e=>e.groups.forEach((e=>e.rules.forEach(a))))),e}),[t,r]),i=[];return n[j.x_.Firing]&&i.push((0,m.jsxs)(Z,{status:j.x_.Firing,children:[n[j.x_.Firing]," firing"]},"firing")),n.error&&i.push((0,m.jsxs)(Z,{status:j.x_.Firing,children:[n.error," errors"]},"errors")),n[j.x_.Pending]&&i.push((0,m.jsxs)(Z,{status:j.x_.Pending,children:[n[j.x_.Pending]," pending"]},"pending")),a&&n[j.x_.Inactive]&&i.push((0,m.jsxs)(Z,{status:"neutral",children:[n[j.x_.Inactive]," normal"]},"inactive")),s&&n.recording&&i.push((0,m.jsxs)(Z,{status:"neutral",children:[n.recording," recording"]},"recording")),(0,m.jsxs)("div",{children:[(0,m.jsxs)("span",{children:[n.total," ",V()("rule",n.total)]}),!!i.length&&(0,m.jsxs)(m.Fragment,{children:[Q||(Q=(0,m.jsx)("span",{children:": "})),i.reduce(((e,a,s)=>e.length?[e,(0,m.jsx)(o.Fragment,{children:J||(J=(0,m.jsx)("span",{children:", "}))},s),a]:[a]),[])]})]})};var ee=s("./public/app/features/alerting/unified/utils/time.ts"),ae=s("./public/app/features/alerting/unified/utils/redux.ts"),se=s("./public/app/core/hooks/useCleanup.ts");function te(e){var a,s;const{namespace:t,group:r,onClose:n}=e,i=(0,l.useStyles2)(re),u=(0,c.useDispatch)(),{loading:d,error:p,dispatched:g}=null!==(a=(0,h._)((e=>e.updateLotexNamespaceAndGroup)))&&void 0!==a?a:ae.oq,f=(0,o.useMemo)((()=>{var e;return{namespaceName:t.name,groupName:r.name,groupInterval:null!==(e=r.interval)&&void 0!==e?e:""}}),[t,r]);(0,o.useEffect)((()=>{!g||d||p||n()}),[g,d,n,p]),(0,se.x)((e=>e.unifiedAlerting.updateLotexNamespaceAndGroup));return(0,m.jsx)(l.Modal,{className:i.modal,isOpen:!0,title:"Edit namespace or rule group",onDismiss:n,onClickBackdrop:n,children:(0,m.jsx)(l.Form,{defaultValues:f,onSubmit:e=>{u((0,F.hv)({rulesSourceName:(0,x.EG)(t.rulesSource),groupName:r.name,newGroupName:e.groupName,namespaceName:t.name,newNamespaceName:e.namespaceName,groupInterval:e.groupInterval||void 0}))},children:e=>{var a,t,r;let{register:i,errors:o,formState:{isDirty:c}}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.Field,{label:"Namespace",invalid:!!o.namespaceName,error:null===(a=o.namespaceName)||void 0===a?void 0:a.message,children:(0,m.jsx)(l.Input,Object.assign({id:"namespaceName"},i("namespaceName",{required:"Namespace name is required."})))}),(0,m.jsx)(l.Field,{label:"Rule group",invalid:!!o.groupName,error:null===(t=o.groupName)||void 0===t?void 0:t.message,children:(0,m.jsx)(l.Input,Object.assign({id:"groupName"},i("groupName",{required:"Rule group name is required."})))}),(0,m.jsx)(l.Field,{label:"Rule group evaluation interval",invalid:!!o.groupInterval,error:null===(r=o.groupInterval)||void 0===r?void 0:r.message,children:(0,m.jsx)(l.Input,Object.assign({id:"groupInterval",placeholder:"1m"},i("groupInterval",{pattern:ee.lR})))}),(0,m.jsxs)(l.Modal.ButtonRow,{children:[s||(s=(0,m.jsx)(l.Button,{variant:"secondary",type:"button",disabled:d,onClick:n,fill:"outline",children:"Close"})),(0,m.jsx)(l.Button,{type:"submit",disabled:!c||d,children:d?"Saving...":"Save changes"})]})]})}},JSON.stringify(f))})}const re=()=>({modal:T.css`
    max-width: 560px;
  `});var ne;const ie=o.memo((e=>{var a;let{group:s,namespace:t,expandAll:r}=e;const{rulesSource:n}=t,i=(0,l.useStyles2)(le),[c,u]=(0,o.useState)(!1),[d,p]=(0,o.useState)(!r);(0,o.useEffect)((()=>{p(!r)}),[r]);const g=(0,D.h)(),h=null===(a=s.rules[0])||void 0===a?void 0:a.rulerRule,v=h&&(0,f.Pc)(h)&&h.grafana_alert.namespace_uid||void 0,{folder:b}=(0,U.W)(v),j=[];if(g(n)&&!s.rules.find((e=>!!e.rulerRule)))j.push(ne||(ne=(0,m.jsxs)(l.HorizontalGroup,{children:[(0,m.jsx)(l.Spinner,{}),"deleting"]},"is-deleting")));else if(n===x.GC){if(v){const e=`/dashboards/f/${v}/${H.Z.slugifyForUrl(t.name)}`;null!=b&&b.canSave&&j.push((0,m.jsx)(q.A,{"aria-label":"edit folder",icon:"pen",tooltip:"edit folder",to:e+"/settings",target:"__blank"},"edit")),null!=b&&b.canAdmin&&j.push((0,m.jsx)(q.A,{"aria-label":"manage permissions",icon:"lock",tooltip:"manage permissions",to:e+"/permissions",target:"__blank"},"manage-perms"))}}else g(n)&&j.push((0,m.jsx)(q.A,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>u(!0)},"edit"));const y=(0,x.jq)(n)?`${t.name} > ${s.name}`:t.name;return(0,m.jsxs)("div",{className:i.wrapper,"data-testid":"rule-group",children:[(0,m.jsxs)("div",{className:i.header,"data-testid":"rule-group-header",children:[(0,m.jsx)(B.U,{className:i.collapseToggle,isCollapsed:d,onToggle:p,"data-testid":"group-collapse-toggle"}),(0,m.jsx)(l.Icon,{name:d?"folder":"folder-open"}),(0,x.jq)(n)&&(0,m.jsx)(l.Tooltip,{content:n.name,placement:"top",children:(0,m.jsx)("img",{alt:n.meta.name,className:i.dataSourceIcon,src:n.meta.info.logos.small})}),(0,m.jsx)("h6",{className:i.heading,children:y}),(0,m.jsx)("div",{className:i.spacer}),(0,m.jsx)("div",{className:i.headerStats,children:(0,m.jsx)(X,{showInactive:!1,group:s})}),!!j.length&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:i.actionsSeparator,children:"|"}),(0,m.jsx)("div",{className:i.actionIcons,children:j})]})]}),!d&&(0,m.jsx)(M.i,{showSummaryColumn:!0,className:i.rulesTable,showGuidelines:!0,rules:s.rules}),c&&(0,m.jsx)(te,{group:s,namespace:t,onClose:()=>u(!1)})]})}));ie.displayName="RulesGroup";const le=e=>({wrapper:T.css`
    & + & {
      margin-top: ${e.spacing(2)};
    }
  `,header:T.css`
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: ${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0;
    background-color: ${e.colors.background.secondary};
    flex-wrap: wrap;
  `,headerStats:T.css`
    span {
      vertical-align: middle;
    }

    ${e.breakpoints.down("sm")} {
      order: 2;
      width: 100%;
      padding-left: ${e.spacing(1)};
    }
  `,heading:T.css`
    margin-left: ${e.spacing(1)};
    margin-bottom: 0;
  `,spacer:T.css`
    flex: 1;
  `,collapseToggle:T.css`
    background: none;
    border: none;
    margin-top: -${e.spacing(1)};
    margin-bottom: -${e.spacing(1)};

    svg {
      margin-bottom: 0;
    }
  `,dataSourceIcon:T.css`
    width: ${e.spacing(2)};
    height: ${e.spacing(2)};
    margin-left: ${e.spacing(2)};
  `,dataSourceOrigin:T.css`
    margin-right: 1em;
    color: ${e.colors.text.disabled};
  `,actionsSeparator:T.css`
    margin: 0 ${e.spacing(2)};
  `,actionIcons:T.css`
    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `,rulesTable:T.css`
    margin-top: ${e.spacing(3)};
  `});var oe,ce,ue,de;const pe=e=>{let{namespaces:a,expandAll:s}=e;const t=(0,l.useStyles)(me),r=(0,h._)((e=>e.promRules)),n=(0,o.useMemo)(x.Eu,[]),i=(0,o.useMemo)((()=>n.filter((e=>{var a;return null===(a=r[e.name])||void 0===a?void 0:a.loading}))),[r,n]);return(0,m.jsxs)("section",{className:t.wrapper,children:[(0,m.jsxs)("div",{className:t.sectionHeader,children:[oe||(oe=(0,m.jsx)("h5",{children:"Cortex / Loki"})),i.length?(0,m.jsx)(l.LoadingPlaceholder,{className:t.loader,text:`Loading rules from ${i.length} ${V()("source",i.length)}`}):ce||(ce=(0,m.jsx)("div",{}))]}),a.map((e=>{const{groups:a,rulesSource:t}=e;return a.map((a=>(0,m.jsx)(ie,{group:a,namespace:e,expandAll:s},`${(0,x.EG)(t)}-${name}-${a.name}`)))})),0===(null==a?void 0:a.length)&&!!n.length&&(ue||(ue=(0,m.jsx)("p",{children:"No rules found."}))),!n.length&&(de||(de=(0,m.jsx)("p",{children:"There are no Prometheus or Loki datas sources configured."})))]})},me=e=>({loader:T.css`
    margin-bottom: 0;
  `,sectionHeader:T.css`
    display: flex;
    justify-content: space-between;
  `,wrapper:T.css`
    margin-bottom: ${e.spacing.xl};
  `});var ge,he,xe;const fe=e=>{let{namespaces:a,expandAll:s}=e;const t=(0,l.useStyles)(ve),{loading:r}=(0,h._)((e=>e.promRules[x.GC]||ae.oq));return(0,m.jsxs)("section",{className:t.wrapper,children:[(0,m.jsxs)("div",{className:t.sectionHeader,children:[ge||(ge=(0,m.jsx)("h5",{children:"Grafana"})),r?(0,m.jsx)(l.LoadingPlaceholder,{className:t.loader,text:"Loading..."}):he||(he=(0,m.jsx)("div",{}))]}),null==a?void 0:a.map((e=>e.groups.map((a=>(0,m.jsx)(ie,{group:a,namespace:e,expandAll:s},`${e.name}-${a.name}`))))),0===(null==a?void 0:a.length)&&(xe||(xe=(0,m.jsx)("p",{children:"No rules found."})))]})},ve=e=>({loader:T.css`
    margin-bottom: 0;
  `,sectionHeader:T.css`
    display: flex;
    justify-content: space-between;
  `,wrapper:T.css`
    margin-bottom: ${e.spacing.xl};
  `}),be=e=>{let{rules:a,state:s,defaultCollapsed:t=!1}=e;const[r,n]=(0,o.useState)(t),i=(0,l.useStyles2)(je);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h4",{className:i.header,children:[(0,m.jsx)(B.U,{className:i.collapseToggle,size:"xxl",isCollapsed:r,onToggle:()=>n(!r)}),(0,f.SS)(s)," (",a.length,")"]}),!r&&(0,m.jsx)(M.i,{className:i.rulesTable,rules:a,showGroupColumn:!0})]})},je=e=>({collapseToggle:T.css`
    vertical-align: middle;
  `,header:T.css`
    margin-top: ${e.spacing(2)};
  `,rulesTable:T.css`
    margin-top: ${e.spacing(3)};
  `});var ye=s("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js");function Se(){const[e,a]=(0,o.useState)(!1),[s,t]=(0,o.useState)(!1),r=(0,h._)((e=>e.promRules)),n=(0,h._)((e=>e.rulerRules)),i=(0,l.useStyles2)(_e),c=(0,o.useMemo)((()=>{var e,a;const[s,t]=[r,n].map((e=>(0,x.Eu)().reduce(((a,s)=>{var t;const r=null===(t=e[s.name])||void 0===t?void 0:t.error;return e[s.name]&&r&&!(0,f.m$)(e[s.name])?[...a,{dataSource:s,error:r}]:a}),[]))),i=null===(e=r[x.GC])||void 0===e?void 0:e.error,l=null===(a=n[x.GC])||void 0===a?void 0:a.error,o=[];return i&&o.push((0,m.jsxs)(m.Fragment,{children:["Failed to load Grafana rules state: ",i.message||"Unknown error."]})),l&&o.push((0,m.jsxs)(m.Fragment,{children:["Failed to load Grafana rules config: ",l.message||"Unknown error."]})),s.forEach((e=>{let{dataSource:a,error:s}=e;return o.push((0,m.jsxs)(m.Fragment,{children:["Failed to load rules state from ",(0,m.jsx)("a",{href:`datasources/edit/${a.uid}`,children:a.name}),":"," ",s.message||"Unknown error."]}))})),t.forEach((e=>{let{dataSource:a,error:s}=e;return o.push((0,m.jsxs)(m.Fragment,{children:["Failed to load rules config from ",(0,m.jsx)("a",{href:`datasources/edit/${a.uid}`,children:a.name}),":"," ",s.message||"Unknown error."]}))})),o}),[r,n]);return(0,m.jsx)(m.Fragment,{children:!!c.length&&!s&&(0,m.jsxs)(l.Alert,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>t(!0),children:[e&&c.map(((e,a)=>(0,m.jsx)("div",{children:e},a))),!e&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:c[0]}),c.length>=2&&(0,m.jsxs)(l.Button,{className:i.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>a(!0),children:[c.length-1," more ",V()("error",c.length-1)]})]})]})})}const _e=e=>({moreButton:T.css`
    padding: 0;
  `});var we,Ce,Ne;const Re={groups:e=>{let{namespaces:a,expandAll:s}=e;const[t,r]=(0,o.useMemo)((()=>{const e=a.map((e=>Object.assign({},e,{groups:e.groups.sort(((e,a)=>e.name.localeCompare(a.name)))}))).sort(((e,a)=>e.name.localeCompare(a.name)));return[e.filter((e=>(0,x.HY)(e.rulesSource))),e.filter((e=>(0,x.jq)(e.rulesSource)))]}),[a]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(fe,{namespaces:t,expandAll:s}),(0,m.jsx)(pe,{namespaces:r,expandAll:s})]})},state:e=>{let{namespaces:a}=e;const s=(0,v.lC)((0,b.K)()[0]),t=(0,o.useMemo)((()=>{const e={[j.x_.Firing]:[],[j.x_.Inactive]:[],[j.x_.Pending]:[]};return a.forEach((a=>a.groups.forEach((a=>a.rules.forEach((a=>{a.promRule&&(0,f.x_)(a.promRule)&&e[a.promRule.state].push(a)})))))),Object.values(e).forEach((e=>e.sort(((e,a)=>e.name.localeCompare(a.name))))),e}),[a]);return(0,m.jsxs)(m.Fragment,{children:[(!s.alertState||s.alertState===j.x_.Firing)&&(0,m.jsx)(be,{state:j.x_.Firing,rules:t[j.x_.Firing]}),(!s.alertState||s.alertState===j.x_.Pending)&&(0,m.jsx)(be,{state:j.x_.Pending,rules:t[j.x_.Pending]}),(!s.alertState||s.alertState===j.x_.Inactive)&&(0,m.jsx)(be,{defaultCollapsed:s.alertState!==j.x_.Inactive,state:j.x_.Inactive,rules:t[j.x_.Inactive]})]})}},ke=(0,l.withErrorBoundary)((()=>{const e=(0,c.useDispatch)(),a=(0,l.useStyles2)($e),s=(0,o.useMemo)(x.mA,[]),t=(0,ye.TH)(),[r,n]=(0,o.useState)(!1),[d]=(0,b.K)(),f=(0,v.lC)(d),j=Object.values(f).some((e=>void 0!==e)),y=Re[d.view]?d.view:"groups",_=Re[y];(0,o.useEffect)((()=>{e((0,F.ei)());const a=setInterval((()=>e((0,F.ei)())),z.p4);return()=>{clearInterval(a)}}),[e]);const w=(0,h._)((e=>e.promRules)),C=(0,h._)((e=>e.rulerRules)),N=s.some((e=>{var a,s;return(null===(a=w[e])||void 0===a?void 0:a.dispatched)||(null===(s=C[e])||void 0===s?void 0:s.dispatched)})),R=s.some((e=>{var a,s;return(null===(a=w[e])||void 0===a?void 0:a.loading)||(null===(s=C[e])||void 0===s?void 0:s.loading)})),k=s.some((e=>{var a,s,t,r,n;return(null===(a=w[e])||void 0===a||null===(s=a.result)||void 0===s?void 0:s.length)&&!(null!==(t=w[e])&&void 0!==t&&t.error)||Object.keys((null===(r=C[e])||void 0===r?void 0:r.result)||{}).length&&!(null!==(n=C[e])&&void 0!==n&&n.error)})),$=N&&!R&&!k,A=(e=>{const[a]=(0,b.K)(),s=(0,v.lC)(a);return(0,o.useMemo)((()=>e.filter((e=>{let{rulesSource:a}=e;return!s.dataSource||!(0,x.jq)(a)||a.name===s.dataSource})).reduce(S(s),[])),[e,s])})((0,I.Z)());return(0,m.jsxs)(u.J,{pageId:"alert-list",isLoading:R&&!k,children:[we||(we=(0,m.jsx)(Se,{})),!$&&(0,m.jsxs)(m.Fragment,{children:[Ce||(Ce=(0,m.jsx)(O,{})),(0,m.jsx)("div",{className:a.break}),(0,m.jsxs)("div",{className:a.buttonsContainer,children:[(0,m.jsxs)("div",{className:a.statsContainer,children:["groups"===y&&j&&(0,m.jsx)(l.Button,{className:a.expandAllButton,icon:r?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>n(!r),children:r?"Collapse all":"Expand all"}),(0,m.jsx)(X,{showInactive:!0,showRecording:!0,namespaces:A})]}),(p.Vt.hasEditPermissionInFolders||p.Vt.isEditor)&&(0,m.jsx)(l.LinkButton,{href:i.urlUtil.renderUrl("alerting/new",{returnTo:t.pathname+t.search}),icon:"plus",children:"New alert rule"})]})]}),$&&(Ne||(Ne=(0,m.jsx)(g,{}))),k&&(0,m.jsx)(_,{expandAll:r,namespaces:A})]})}),{style:"page"}),$e=e=>({break:T.css`
    width: 100%;
    height: 0;
    margin-bottom: ${e.spacing(2)};
    border-bottom: solid 1px ${e.colors.border.medium};
  `,buttonsContainer:T.css`
    margin-bottom: ${e.spacing(2)};
    display: flex;
    justify-content: space-between;
  `,statsContainer:T.css`
    display: flex;
    flex-direction: row;
    align-items: center;
  `,expandAllButton:T.css`
    margin-right: ${e.spacing(1)};
  `});var Ae=s("./public/app/features/alerting/AlertRuleList.tsx");const Fe=n.config.unifiedAlertingEnabled?ke:Ae.default},"./public/app/features/alerting/state/actions.ts":(e,a,s)=>{s.d(a,{Au:()=>l,en:()=>o,C2:()=>c,fg:()=>u,c1:()=>d,fA:()=>p,tk:()=>m});var t=s("./packages/grafana-data/src/index.ts"),r=s("./packages/grafana-runtime/src/index.ts"),n=s("./public/app/core/core.ts"),i=s("./public/app/features/alerting/state/reducers.ts");function l(e){return async a=>{a((0,i.gz)());const s=await(0,r.getBackendSrv)().get("/api/alerts",e);a((0,i.Oc)(s))}}function o(e,a){return async s=>{await(0,r.getBackendSrv)().post(`/api/alerts/${e}/pause`,a);s(l({state:(r.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async a=>{try{await(0,r.getBackendSrv)().post("/api/alert-notifications",e),n.h$.emit(t.AppEvents.alertSuccess,["Notification created"]),r.locationService.push("/alerting/notifications")}catch(e){n.h$.emit(t.AppEvents.alertError,[e.data.error])}}}function u(e){return async a=>{try{await(0,r.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),n.h$.emit(t.AppEvents.alertSuccess,["Notification updated"])}catch(e){n.h$.emit(t.AppEvents.alertError,[e.data.error])}}}function d(e){return async(a,s)=>{const t=s().notificationChannel.notificationChannel;await(0,r.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:t.id},e))}}function p(){return async e=>{const a=(await(0,r.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,a)=>e.name>a.name?1:-1));e((0,i.T2)(a))}}function m(e){return async a=>{await a(p());const s=await(0,r.getBackendSrv)().get(`/api/alert-notifications/${e}`);a((0,i.K)(s))}}},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,a,s)=>{s.d(a,{J:()=>l});s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var t=s("./public/app/core/components/Page/Page.tsx"),r=s("./public/app/core/selectors/navModel.ts"),n=s("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),i=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{children:a,pageId:s,isLoading:l}=e;const o=(0,r.h)((0,n.useSelector)((e=>e.navIndex)),s);return(0,i.jsx)(t.Z,{navModel:o,children:(0,i.jsx)(t.Z.Contents,{isLoading:l,children:a})})}},"./public/app/features/alerting/unified/components/DynamicTableWithGuidelines.tsx":(e,a,s)=>{s.d(a,{F:()=>o});var t=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=s("./packages/grafana-ui/src/index.ts"),n=(s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s("./public/app/features/alerting/unified/components/DynamicTable.tsx")),i=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const l=["renderExpandedContent"];const o=e=>{let{renderExpandedContent:a}=e,s=function(e,a){if(null==e)return{};var s,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)s=n[t],a.indexOf(s)>=0||(r[s]=e[s]);return r}(e,l);const o=(0,r.useStyles2)(c);return(0,i.jsx)(n.t,Object.assign({renderExpandedContent:a?(e,s,r)=>(0,i.jsxs)(i.Fragment,{children:[!(s===r.length-1)&&(0,i.jsx)("div",{className:(0,t.cx)(o.contentGuideline,o.guideline)}),a(e,s,r)]}):void 0,renderPrefixHeader:()=>(0,i.jsx)("div",{className:o.relative,children:(0,i.jsx)("div",{className:(0,t.cx)(o.headerGuideline,o.guideline)})}),renderPrefixCell:(e,a,s)=>(0,i.jsxs)("div",{className:o.relative,children:[(0,i.jsx)("div",{className:(0,t.cx)(o.topGuideline,o.guideline)}),!(a===s.length-1)&&(0,i.jsx)("div",{className:(0,t.cx)(o.bottomGuideline,o.guideline)})]})},s))},c=e=>({relative:t.css`
    position: relative;
    height: 100%;
  `,guideline:t.css`
    left: -19px;
    border-left: 1px solid ${e.colors.border.medium};
    position: absolute;

    ${e.breakpoints.down("md")} {
      display: none;
    }
  `,topGuideline:t.css`
    width: 18px;
    border-bottom: 1px solid ${e.colors.border.medium};
    top: 0;
    bottom: 50%;
  `,bottomGuideline:t.css`
    top: 50%;
    bottom: 0;
  `,contentGuideline:t.css`
    top: 0;
    bottom: 0;
    left: -49px !important;
  `,headerGuideline:t.css`
    top: -25px;
    bottom: 0;
  `})},"./public/app/features/alerting/unified/components/rules/ActionIcon.tsx":(e,a,s)=>{s.d(a,{A:()=>o});var t=s("./packages/grafana-ui/src/index.ts"),r=(s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js")),n=s("./.yarn/__virtual__/react-router-dom-virtual-e45eb1b58b/0/cache/react-router-dom-npm-5.3.0-aa9adb5bec-47584fd629.zip/node_modules/react-router-dom/esm/react-router-dom.js"),i=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const l=["tooltip","icon","to","target","onClick","className","tooltipPlacement"];const o=e=>{var a;let{tooltip:s,icon:o,to:u,target:d,onClick:p,className:m,tooltipPlacement:g="top"}=e,h=function(e,a){if(null==e)return{};var s,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)s=n[t],a.indexOf(s)>=0||(r[s]=e[s]);return r}(e,l);const x=(0,i.jsx)(t.Icon,Object.assign({role:"button",className:(0,r.cx)((0,t.useStyles)(c),m),onClick:p,name:o},h)),f="string"==typeof s?s:void 0;return(0,i.jsx)(t.Tooltip,{content:s,placement:g,children:u?a||(a=(0,i.jsx)(n.Link,{"aria-label":f,to:u,target:d,children:x})):x})},c=()=>r.css`
  cursor: pointer;
`},"./public/app/features/alerting/unified/components/rules/RulesTable.tsx":(e,a,s)=>{s.d(a,{i:()=>_});var t=s("./packages/grafana-ui/src/index.ts"),r=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=s("./public/app/features/alerting/unified/components/AlertLabels.tsx"),l=s("./public/app/features/alerting/unified/components/DetailsField.tsx"),o=s("./public/app/features/alerting/unified/components/rules/RuleDetailsActionButtons.tsx"),c=s("./public/app/features/alerting/unified/components/rules/RuleDetailsDataSources.tsx"),u=s("./public/app/features/alerting/unified/components/rules/RuleDetailsMatchingInstances.tsx"),d=s("./public/app/features/alerting/unified/components/rules/RuleDetailsExpression.tsx"),p=s("./public/app/features/alerting/unified/components/rules/RuleDetailsAnnotations.tsx"),m=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const g=e=>{let{rule:a}=e;const s=(0,t.useStyles2)(h),{promRule:r,namespace:{rulesSource:n}}=a,g=Object.entries(a.annotations).filter((e=>{let[a,s]=e;return!!s.trim()}));return(0,m.jsxs)("div",{children:[(0,m.jsx)(o.f,{rule:a,rulesSource:n}),(0,m.jsxs)("div",{className:s.wrapper,children:[(0,m.jsxs)("div",{className:s.leftSide,children:[!!a.labels&&!!Object.keys(a.labels).length&&(0,m.jsx)(l.C,{label:"Labels",horizontal:!0,children:(0,m.jsx)(i.s,{labels:a.labels})}),(0,m.jsx)(d.C,{rulesSource:n,rule:a,annotations:g}),(0,m.jsx)(p.J,{annotations:g})]}),(0,m.jsx)("div",{className:s.rightSide,children:(0,m.jsx)(c.C,{rulesSource:n,rule:a})})]}),(0,m.jsx)(u.M,{promRule:r})]})},h=e=>({wrapper:n.css`
    display: flex;
    flex-direction: row;
    ${e.breakpoints.down("md")} {
      flex-direction: column;
    }
  `,leftSide:n.css`
    flex: 1;
  `,rightSide:n.css`
    ${e.breakpoints.up("md")} {
      padding-left: 90px;
      width: 300px;
    }
  `});var x=s("./public/app/features/alerting/unified/utils/datasource.ts"),f=s("./public/app/features/alerting/unified/hooks/useHasRuler.ts"),v=s("./public/app/features/alerting/unified/utils/constants.ts"),b=s("./public/app/features/alerting/unified/components/rules/RuleState.tsx"),j=s("./public/app/features/alerting/unified/components/rules/RuleHealth.tsx"),y=s("./public/app/features/alerting/unified/components/DynamicTable.tsx"),S=s("./public/app/features/alerting/unified/components/DynamicTableWithGuidelines.tsx");const _=e=>{let{rules:a,className:s,showGuidelines:i=!1,emptyMessage:l="No rules found.",showGroupColumn:o=!1,showSummaryColumn:c=!1}=e;const u=(0,t.useStyles2)(w),d=(0,n.cx)(u.wrapper,s,{[u.wrapperMargin]:i}),p=(0,r.useMemo)((()=>{const e=[];return a.map(((a,s)=>{var t;let r=JSON.stringify([null===(t=a.promRule)||void 0===t?void 0:t.type,a.labels,a.query,a.name,a.annotations]);return e.includes(r)&&(r+=`-${s}`),e.push(r),{id:r,data:a}}))}),[a]),h=function(e,a){const s=(0,f.h)();return(0,r.useMemo)((()=>{const t=[{id:"state",label:"State",renderCell:e=>{let{data:a}=e;const{namespace:t}=a,{rulesSource:r}=t,{promRule:n,rulerRule:i}=a,l=!(!s(r)||!n||i),o=!(!s(r)||!i||n);return(0,m.jsx)(b.p,{rule:a,isDeleting:l,isCreating:o})},size:"165px"},{id:"name",label:"Name",renderCell:e=>{let{data:a}=e;return a.name},size:5},{id:"health",label:"Health",renderCell:e=>{let{data:{promRule:a}}=e;return a?(0,m.jsx)(j.V,{rule:a}):null},size:"75px"}];return e&&t.push({id:"summary",label:"Summary",renderCell:e=>{var a;let{data:s}=e;return null!==(a=s.annotations[v.q6.summary])&&void 0!==a?a:""},size:5}),a&&t.push({id:"group",label:"Group",renderCell:e=>{let{data:a}=e;const{namespace:s,group:t}=a,{rulesSource:r}=s;return(0,x.jq)(r)?`${s.name} > ${t.name}`:s.name},size:5}),t}),[s,e,a])}(c,o);if(!a.length)return(0,m.jsx)("div",{className:(0,n.cx)(d,u.emptyMessage),children:l});const _=i?S.F:y.t;return(0,m.jsx)("div",{className:d,"data-testid":"rules-table",children:(0,m.jsx)(_,{cols:h,isExpandable:!0,items:p,renderExpandedContent:e=>{let{data:a}=e;return(0,m.jsx)(g,{rule:a})}})})},w=e=>({wrapperMargin:n.css`
    ${e.breakpoints.up("md")} {
      margin-left: 36px;
    }
  `,emptyMessage:n.css`
    padding: ${e.spacing(1)};
  `,wrapper:n.css`
    width: auto;
    background-color: ${e.colors.background.secondary};
    border-radius: ${e.shape.borderRadius()};
  `})},"./public/app/features/alerting/unified/hooks/useHasRuler.ts":(e,a,s)=>{s.d(a,{h:()=>i});var t=s("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=s("./public/app/features/alerting/unified/utils/datasource.ts"),n=s("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function i(){const e=(0,n._)((e=>e.rulerRules));return(0,t.useCallback)((a=>{var s;const t="string"==typeof a?a:a.name;return t===r.GC||!(null===(s=e[t])||void 0===s||!s.result)}),[e])}}}]);
//# sourceMappingURL=AlertRuleListIndex.44e4de8a0bb9f2fbf136.js.map