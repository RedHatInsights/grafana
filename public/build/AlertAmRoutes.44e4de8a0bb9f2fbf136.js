"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8648],{"./public/app/core/hooks/useCleanup.ts":(e,a,t)=>{t.d(a,{x:()=>i});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),l=t("./public/app/core/actions/cleanUp.ts");function i(e){const a=(0,r.useDispatch)(),t=(0,n.useRef)(e);t.current=e,(0,n.useEffect)((()=>()=>{a((0,l.e)({stateSelector:t.current}))}),[a])}},"./public/app/core/hooks/useQueryParams.ts":(e,a,t)=>{t.d(a,{K:()=>i});var n=t("./packages/grafana-runtime/src/index.ts"),r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),l=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js");function i(){const{search:e}=(0,l.TH)();return[(0,r.useMemo)((()=>(0,n.locationSearchToObject)(e||"")),[e]),(0,r.useCallback)(((e,a)=>n.locationService.partial(e,a)),[])]}},"./public/app/features/alerting/unified/AmRoutes.tsx":(e,a,t)=>{t.r(a),t.d(a,{default:()=>Ve});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),l=t("./packages/grafana-ui/src/index.ts"),i=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),s=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),o=t("./public/app/core/hooks/useCleanup.ts"),c=t("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),u=t("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),d=t("./public/app/plugins/datasource/alertmanager/types.ts"),p=t("./public/app/features/alerting/unified/utils/time.ts"),g=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),m=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),v=t("./public/app/features/alerting/unified/utils/datasource.ts");const h=["",p.qr[0].value],x=(e,a)=>Object.entries(null!=e?e:{}).reduce(((e,t)=>{let[n,r]=t;return[...e,{name:n,value:r,operator:a?d._M.regex:d._M.equal}]}),[]),f=e=>{if(!e)return h;const[a,t]=e?(0,p.bG)(e):[void 0,void 0],n=p.qr.find((e=>e.value===t));return a&&n?[String(a),n.value]:h},j=e=>e.value,b={name:"",value:"",operator:d._M.equal},y={id:"",groupBy:[],object_matchers:[],routes:[],continue:!1,receiver:"",groupWaitValue:"",groupWaitValueType:p.qr[0].value,groupIntervalValue:"",groupIntervalValueType:p.qr[0].value,repeatIntervalValue:"",repeatIntervalValueType:p.qr[0].value},C=e=>{var a,t,n,r,l,i,s,o;if(!e||0===Object.keys(e).length)return[y,{}];const[c,u]=f(e.group_wait),[d,p]=f(e.group_interval),[g,v]=f(e.repeat_interval),h=String(Math.random()),j={[h]:e},b=[];null===(a=e.routes)||void 0===a||a.forEach((e=>{const[a,t]=C(e);b.push(a),Object.assign(j,t)}));return[{id:h,object_matchers:[...e.matchers?null!==(t=null===(n=e.matchers)||void 0===n?void 0:n.map((e=>(0,m.cm)((0,m.tC)(e)))))&&void 0!==t?t:[]:null!==(r=null===(l=e.object_matchers)||void 0===l?void 0:l.map((e=>({name:e[0],operator:e[1],value:e[2]}))))&&void 0!==r?r:[],...x(e.match,!1),...x(e.match_re,!0)],continue:null!==(i=e.continue)&&void 0!==i&&i,receiver:null!==(s=e.receiver)&&void 0!==s?s:"",groupBy:null!==(o=e.group_by)&&void 0!==o?o:[],groupWaitValue:c,groupWaitValueType:u,groupIntervalValue:d,groupIntervalValueType:p,repeatIntervalValue:g,repeatIntervalValueType:v,routes:b},j]},S=(e,a,t)=>{const n=t[a.id],r=Object.assign({},null!=n?n:{},{continue:a.continue,group_by:a.groupBy,object_matchers:a.object_matchers.length?a.object_matchers.map((e=>[e.name,e.operator,e.value])):void 0,match:void 0,match_re:void 0,group_wait:a.groupWaitValue?`${a.groupWaitValue}${a.groupWaitValueType}`:void 0,group_interval:a.groupIntervalValue?`${a.groupIntervalValue}${a.groupIntervalValueType}`:void 0,repeat_interval:a.repeatIntervalValue?`${a.repeatIntervalValue}${a.repeatIntervalValueType}`:void 0,routes:a.routes.map((a=>S(e,a,t)))});return e!==v.GC?(r.matchers=a.object_matchers.map((e=>{let{name:a,operator:t,value:n}=e;return`${a}${t}${n}`})),r.object_matchers=void 0):r.matchers=void 0,a.receiver&&(r.receiver=a.receiver),(0,g.omitBy)(r,g.isUndefined)},I=e=>({label:e,value:e}),_=e=>(null!=e?e:[]).map(I),V=e=>{var a;return e&&null!==(a=j(e))&&void 0!==a?a:""},N=e=>{return e?(null!=(a=e)?a:[]).map(j):[];var a},$=e=>{if(e)return/^\d+$/.test(e)?void 0:"Must be a positive integer."};var k=t("./public/app/features/alerting/unified/utils/misc.ts");const w=e=>({container:r.css`
      align-items: center;
      display: flex;
      flex-flow: row nowrap;

      & > * + * {
        margin-left: ${e.spacing(1)};
      }
    `,input:r.css`
      flex: 1;
    `,timingContainer:r.css`
      max-width: ${e.spacing(33)};
    `,smallInput:r.css`
      width: ${e.spacing(6.5)};
    `,linkText:r.css`
      text-decoration: underline;
    `,collapse:r.css`
      border: none;
      background: none;
      color: ${e.colors.text.primary};
    `});var O,M,T=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const B=["onChange","ref"],F=["onChange","ref"],G=["onChange","ref"],z=["onChange","ref"],E=["onChange","ref"];function W(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}const A=e=>{var a;let{alertManagerSourceName:t,onCancel:i,onSave:s,receivers:o,routes:c}=e;const u=(0,l.useStyles2)(w),[d,g]=(0,n.useState)(!1),[m,v]=(0,n.useState)(_(c.groupBy));return(0,T.jsx)(l.Form,{defaultValues:c,onSubmit:s,children:e=>{var n,s,c,h;let{control:x,errors:f,setValue:j}=e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Field,{label:"Default contact point",invalid:!!f.receiver,error:null===(n=f.receiver)||void 0===n?void 0:n.message,children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:u.container,"data-testid":"am-receiver-select",children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=W(e.field,B);return(0,T.jsx)(l.Select,Object.assign({"aria-label":"Default contact point"},t,{className:u.input,onChange:e=>a(V(e)),options:o,menuShouldPortal:!0}))},control:x,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),O||(O=(0,T.jsx)("span",{children:"or"})),(0,T.jsx)(l.Link,{className:u.linkText,href:(0,k.eQ)("/alerting/notifications/receivers/new",t),children:"Create a contact point"})]})})}),(0,T.jsx)(l.Field,{label:"Group by",description:"Group alerts when you receive a notification based on labels.","data-testid":"am-group-select",children:(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=W(e.field,F);return(0,T.jsx)(l.MultiSelect,Object.assign({"aria-label":"Group by",menuShouldPortal:!0},t,{allowCustomValue:!0,className:u.input,onCreateOption:e=>{v((a=>[...a,I(e)])),j("groupBy",[...t.value,e])},onChange:e=>a(N(e)),options:m}))},control:x,name:"groupBy"})}),(0,T.jsxs)(l.Collapse,{collapsible:!0,className:u.collapse,isOpen:d,label:"Timing options",onToggle:g,children:[(0,T.jsx)(l.Field,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. Default 30 seconds.",invalid:!!f.groupWaitValue,error:null===(s=f.groupWaitValue)||void 0===s?void 0:s.message,"data-testid":"am-group-wait",children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Default 30 seconds"}))},control:x,name:"groupWaitValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=W(e.field,G);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,onChange:e=>a(V(e)),options:p.qr,"aria-label":"Group wait type"}))},control:x,name:"groupWaitValueType"})]})})}),(0,T.jsx)(l.Field,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. Default 5 minutes.",invalid:!!f.groupIntervalValue,error:null===(c=f.groupIntervalValue)||void 0===c?void 0:c.message,"data-testid":"am-group-interval",children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Default 5 minutes"}))},control:x,name:"groupIntervalValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=W(e.field,z);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,onChange:e=>a(V(e)),options:p.qr,"aria-label":"Group interval type"}))},control:x,name:"groupIntervalValueType"})]})})}),(0,T.jsx)(l.Field,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent. Default 4 hours.",invalid:!!f.repeatIntervalValue,error:null===(h=f.repeatIntervalValue)||void 0===h?void 0:h.message,"data-testid":"am-repeat-interval",children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Default 4 hours"}))},control:x,name:"repeatIntervalValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=W(e.field,E);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,menuPlacement:"top",onChange:e=>a(V(e)),options:p.qr,"aria-label":"Repeat interval type"}))},control:x,name:"repeatIntervalValueType"})]})})})]}),(0,T.jsxs)("div",{className:u.container,children:[M||(M=(0,T.jsx)(l.Button,{type:"submit",children:"Save"})),a||(a=(0,T.jsx)(l.Button,{onClick:i,type:"reset",variant:"secondary",fill:"outline",children:"Cancel"}))]})]})}})},R=e=>({container:r.css`
      display: grid;
      font-style: ${e.typography.fontSize};
      grid-template-columns: ${e.spacing(15.5)} auto;

      ${e.breakpoints.down("md")} {
        grid-template-columns: 100%;
      }
    `,titleCell:r.css`
      color: ${e.colors.text.primary};
    `,valueCell:r.css`
      color: ${e.colors.text.secondary};
      margin-bottom: ${e.spacing(1)};
    `}),q=e=>{let{routes:a}=e;const t=(0,l.useStyles2)(R),n=a.receiver||"-",r=a.groupBy.join(", ")||"-",i=a.groupWaitValue?`${a.groupWaitValue}${a.groupWaitValueType}`:"-",s=a.groupIntervalValue?`${a.groupIntervalValue}${a.groupIntervalValueType}`:"-",o=a.repeatIntervalValue?`${a.repeatIntervalValue}${a.repeatIntervalValueType}`:"-";return(0,T.jsxs)("div",{className:t.container,children:[(0,T.jsx)("div",{className:t.titleCell,children:"Contact point"}),(0,T.jsx)("div",{className:t.valueCell,"data-testid":"am-routes-root-receiver",children:n}),(0,T.jsx)("div",{className:t.titleCell,children:"Group by"}),(0,T.jsx)("div",{className:t.valueCell,"data-testid":"am-routes-root-group-by",children:r}),(0,T.jsx)("div",{className:t.titleCell,children:"Timings"}),(0,T.jsxs)("div",{className:t.valueCell,"data-testid":"am-routes-root-timings",children:["Group wait: ",i," | Group interval: ",s," | Repeat interval: ",o]})]})};var P,D;const L=e=>{let{isEditMode:a,onSave:t,onEnterEditMode:n,onExitEditMode:r,receivers:i,routes:s,alertManagerSourceName:o}=e;const c=(0,l.useStyles2)(Y),u=(0,v.RY)(o);return(0,T.jsxs)("div",{className:c.container,"data-testid":"am-root-route-container",children:[(0,T.jsxs)("div",{className:c.titleContainer,children:[(0,T.jsxs)("h5",{className:c.title,children:["Root policy - ",P||(P=(0,T.jsx)("i",{children:"default for all alerts"}))]}),!a&&!u&&(0,T.jsx)(l.Button,{icon:"pen",onClick:n,size:"sm",type:"button",variant:"secondary",children:"Edit"})]}),D||(D=(0,T.jsx)("p",{children:"All alerts will go to the default contact point, unless you set additional matchers in the specific routing area."})),a?(0,T.jsx)(A,{alertManagerSourceName:o,onCancel:r,onSave:t,receivers:i,routes:s}):(0,T.jsx)(q,{routes:s})]})},Y=e=>({container:r.css`
      background-color: ${e.colors.background.secondary};
      color: ${e.colors.text.secondary};
      padding: ${e.spacing(2)};
    `,titleContainer:r.css`
      color: ${e.colors.text.primary};
      display: flex;
      flex-flow: row nowrap;
    `,title:r.css`
      flex: 100%;
    `}),Z=e=>{let{children:a}=e;const t=(0,l.useStyles)(U);return(0,T.jsx)("div",{className:t.container,children:a})},U=e=>({container:r.css`
      background-color: ${e.colors.bg2};
      color: ${e.colors.textSemiWeak};
      padding: ${e.spacing.xl};
      text-align: center;
    `});var H=t("./public/app/features/alerting/unified/components/DynamicTable.tsx");const J=["onChange","ref"],K=["onChange","ref"],Q=["onChange","ref"],X=["onChange","ref"],ee=["onChange","ref"],ae=["onChange","ref"];var te,ne;function re(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}const le=e=>{var a;let{onCancel:t,onSave:i,receivers:s,routes:o}=e;const c=(0,l.useStyles2)(ie),u=(0,l.useStyles2)(w),[d,g]=(0,n.useState)(o.groupBy.length>0),[v,h]=(0,n.useState)(!!o.groupWaitValue||!!o.groupIntervalValue||!!o.repeatIntervalValue),[x,f]=(0,n.useState)(_(o.groupBy));return(0,T.jsx)(l.Form,{defaultValues:o,onSubmit:i,children:e=>{var n,i,o;let{control:j,register:y,errors:C,setValue:S}=e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("input",Object.assign({type:"hidden"},y("id"))),(0,T.jsx)(l.FieldArray,{name:"object_matchers",control:j,children:e=>{let{fields:a,append:t,remove:n}=e;return(0,T.jsxs)(T.Fragment,{children:[te||(te=(0,T.jsx)("div",{children:"Matching labels"})),(0,T.jsx)("div",{className:c.matchersContainer,children:a.map(((e,a)=>{var t,r,i,s,o,u,d,p,g,v;const h=`object_matchers[${a}]`;return(0,T.jsxs)(l.HorizontalGroup,{align:"flex-start",children:[(0,T.jsx)(l.Field,{label:"Label",invalid:!(null===(t=C.object_matchers)||void 0===t||null===(r=t[a])||void 0===r||!r.name),error:null===(i=C.object_matchers)||void 0===i||null===(s=i[a])||void 0===s||null===(o=s.name)||void 0===o?void 0:o.message,children:(0,T.jsx)(l.Input,Object.assign({},y(`${h}.name`,{required:"Field is required"}),{defaultValue:e.name,placeholder:"label"}))}),(0,T.jsx)(l.Field,{label:"Operator",children:(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,J);return(0,T.jsx)(l.Select,Object.assign({},t,{className:c.matchersOperator,onChange:e=>a(null==e?void 0:e.value),options:m.tA,"aria-label":"Operator"}))},defaultValue:e.operator,control:j,name:`${h}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,T.jsx)(l.Field,{label:"Value",invalid:!(null===(u=C.object_matchers)||void 0===u||null===(d=u[a])||void 0===d||!d.value),error:null===(p=C.object_matchers)||void 0===p||null===(g=p[a])||void 0===g||null===(v=g.value)||void 0===v?void 0:v.message,children:(0,T.jsx)(l.Input,Object.assign({},y(`${h}.value`,{required:"Field is required"}),{defaultValue:e.value,placeholder:"value"}))}),(0,T.jsx)(l.IconButton,{className:c.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>n(a),children:"Remove"})]},e.id)}))}),(0,T.jsx)(l.Button,{className:c.addMatcherBtn,icon:"plus",onClick:()=>t(b),variant:"secondary",type:"button",children:"Add matcher"})]})}}),(0,T.jsx)(l.Field,{label:"Contact point",children:(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,K);return(0,T.jsx)(l.Select,Object.assign({"aria-label":"Contact point"},t,{className:u.input,onChange:e=>a(V(e)),options:s,menuShouldPortal:!0}))},control:j,name:"receiver"})}),(0,T.jsx)(l.Field,{label:"Continue matching subsequent sibling nodes",children:(0,T.jsx)(l.Switch,Object.assign({id:"continue-toggle"},y("continue")))}),(0,T.jsx)(l.Field,{label:"Override grouping",children:(0,T.jsx)(l.Switch,{id:"override-grouping-toggle",value:d,onChange:()=>g((e=>!e))})}),d&&(0,T.jsx)(l.Field,{label:"Group by",description:"Group alerts when you receive a notification based on labels.",children:(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,Q);return(0,T.jsx)(l.MultiSelect,Object.assign({"aria-label":"Group by",menuShouldPortal:!0},t,{allowCustomValue:!0,className:u.input,onCreateOption:e=>{f((a=>[...a,I(e)])),S("groupBy",[...t.value,e])},onChange:e=>a(N(e)),options:x}))},control:j,name:"groupBy"})}),(0,T.jsx)(l.Field,{label:"Override general timings",children:(0,T.jsx)(l.Switch,{id:"override-timings-toggle",value:v,onChange:()=>h((e=>!e))})}),v&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Field,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert.",invalid:!!C.groupWaitValue,error:null===(n=C.groupWaitValue)||void 0===n?void 0:n.message,children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Time","aria-label":"Group wait value"}))},control:j,name:"groupWaitValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,X);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,onChange:e=>a(V(e)),options:p.qr,"aria-label":"Group wait type"}))},control:j,name:"groupWaitValueType"})]})})}),(0,T.jsx)(l.Field,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent.",invalid:!!C.groupIntervalValue,error:null===(i=C.groupIntervalValue)||void 0===i?void 0:i.message,children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Time","aria-label":"Group interval value"}))},control:j,name:"groupIntervalValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,ee);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,onChange:e=>a(V(e)),options:p.qr,"aria-label":"Group interval type"}))},control:j,name:"groupIntervalValueType"})]})})}),(0,T.jsx)(l.Field,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent.",invalid:!!C.repeatIntervalValue,error:null===(o=C.repeatIntervalValue)||void 0===o?void 0:o.message,children:(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:(0,r.cx)(u.container,u.timingContainer),children:[(0,T.jsx)(l.InputControl,{render:e=>{let{field:a,fieldState:{invalid:t}}=e;return(0,T.jsx)(l.Input,Object.assign({},a,{className:u.smallInput,invalid:t,placeholder:"Time","aria-label":"Repeat interval value"}))},control:j,name:"repeatIntervalValue",rules:{validate:$}}),(0,T.jsx)(l.InputControl,{render:e=>{let{field:{onChange:a}}=e,t=re(e.field,ae);return(0,T.jsx)(l.Select,Object.assign({menuShouldPortal:!0},t,{className:u.input,menuPlacement:"top",onChange:e=>a(V(e)),options:p.qr,"aria-label":"Repeat interval type"}))},control:j,name:"repeatIntervalValueType"})]})})})]}),(0,T.jsxs)("div",{className:c.buttonGroup,children:[ne||(ne=(0,T.jsx)(l.Button,{type:"submit",children:"Save policy"})),a||(a=(0,T.jsx)(l.Button,{onClick:t,fill:"outline",type:"button",variant:"secondary",children:"Cancel"}))]})]})}})},ie=e=>{const a=e.spacing(3.5);return{addMatcherBtn:r.css`
      margin-bottom: ${a};
    `,matchersContainer:r.css`
      background-color: ${e.colors.background.secondary};
      margin: ${e.spacing(1,0)};
      padding: ${e.spacing(1,4.6,1,1.5)};
      width: fit-content;
    `,matchersOperator:r.css`
      min-width: 140px;
    `,nestedPolicies:r.css`
      margin-top: ${a};
    `,removeButton:r.css`
      margin-left: ${e.spacing(1)};
      margin-top: ${e.spacing(2.5)};
    `,buttonGroup:r.css`
      margin: ${e.spacing(6)} 0 ${a};

      & > * + * {
        margin-left: ${e.spacing(1.5)};
      }
    `}};var se;const oe=e=>{let{onChange:a,receivers:t,routes:r,readOnly:i=!1}=e;const s=(0,l.useStyles2)(ce),o=(0,l.useStyles2)(R),c=r.groupWaitValue?`${r.groupWaitValue}${r.groupWaitValueType}`:"-",u=r.groupIntervalValue?`${r.groupIntervalValue}${r.groupIntervalValueType}`:"-",d=r.repeatIntervalValue?`${r.repeatIntervalValue}${r.repeatIntervalValueType}`:"-",[p,g]=(0,n.useState)(r.routes),[m,v]=(0,n.useState)(!1);return(0,T.jsxs)("div",{className:o.container,children:[(0,T.jsx)("div",{className:o.titleCell,children:"Group wait"}),(0,T.jsx)("div",{className:o.valueCell,children:c}),(0,T.jsx)("div",{className:o.titleCell,children:"Group interval"}),(0,T.jsx)("div",{className:o.valueCell,children:u}),(0,T.jsx)("div",{className:o.titleCell,children:"Repeat interval"}),(0,T.jsx)("div",{className:o.valueCell,children:d}),(0,T.jsx)("div",{className:o.titleCell,children:"Nested policies"}),(0,T.jsxs)("div",{className:o.valueCell,children:[p.length?(0,T.jsx)(de,{isAddMode:m,onCancelAdd:()=>{v(!1),g((e=>{const a=[...e];return a.pop(),a}))},onChange:e=>{a(Object.assign({},r,{routes:e})),m&&v(!1)},receivers:t,routes:p}):se||(se=(0,T.jsx)("p",{children:"No nested policies configured."})),!m&&!i&&(0,T.jsx)(l.Button,{className:s.addNestedRoutingBtn,icon:"plus",onClick:()=>{g((e=>[...e,y])),v(!0)},variant:"secondary",type:"button",children:"Add nested policy"})]})]})},ce=e=>({addNestedRoutingBtn:r.css`
      margin-top: ${e.spacing(2)};
    `});var ue=t("./public/app/features/alerting/unified/components/silences/Matchers.tsx");const de=e=>{let{isAddMode:a,onCancelAdd:t,onChange:r,receivers:i,routes:s,readOnly:o=!1}=e;const[c,u]=(0,n.useState)(!1),[d,p]=(0,n.useState)(),g=(0,n.useCallback)((e=>p(e.id)),[]),v=(0,n.useCallback)((()=>p(void 0)),[]),h=[{id:"matchingCriteria",label:"Matching labels",renderCell:e=>(0,T.jsx)(ue.g,{matchers:e.data.object_matchers.map(m._J)}),size:10},{id:"groupBy",label:"Group by",renderCell:e=>e.data.groupBy.join(", ")||"-",size:5},{id:"receiverChannel",label:"Contact point",renderCell:e=>e.data.receiver||"-",size:5},...o?[]:[{id:"actions",label:"Actions",renderCell:(e,a)=>{if(e.renderExpandedContent)return null;return(0,T.jsxs)(l.HorizontalGroup,{children:[(0,T.jsx)(l.Button,{"aria-label":"Edit route",icon:"pen",onClick:()=>{g(e),u(!0)},size:"sm",type:"button",variant:"secondary",children:"Edit"}),(0,T.jsx)(l.IconButton,{"aria-label":"Delete route",name:"trash-alt",onClick:()=>{const e=[...s];e.splice(a,1),r(e)},type:"button"})]})},size:"100px"}]],x=(0,n.useMemo)((()=>((e,a)=>e.map(((e,t)=>{var n;return{id:null!==(n=null==a?void 0:a(e))&&void 0!==n?n:t,data:e}})))(s)),[s]);return(0,n.useEffect)((()=>{a&&x.length&&p(x[x.length-1].id)}),[a,x]),(0,T.jsx)(H.t,{cols:h,isExpandable:!0,items:x,testIdGenerator:()=>"am-routes-row",onCollapse:v,onExpand:g,isExpanded:e=>d===e.id,renderExpandedContent:(e,n)=>a||c?(0,T.jsx)(le,{onCancel:()=>{a&&t(),u(!1)},onSave:e=>{const a=[...s];a[n]=Object.assign({},a[n],e),u(!1),r(a)},receivers:i,routes:e.data}):(0,T.jsx)(oe,{onChange:a=>{const t=[...s];t[n]=Object.assign({},e.data,a),r(t)},receivers:i,routes:e.data,readOnly:o})})},pe=e=>{let{buttonIcon:a,buttonLabel:t,buttonSize:n="lg",buttonVariant:r="primary",onButtonClick:i,text:s}=e;const o=(0,l.useStyles)(ge);return(0,T.jsx)(Z,{children:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("p",{className:o.text,children:s}),(0,T.jsx)(l.Button,{className:o.button,icon:a,onClick:i,size:n,type:"button",variant:r,children:t})]})})},ge=e=>({container:r.css`
      background-color: ${e.colors.bg2};
      color: ${e.colors.textSemiWeak};
      padding: ${e.spacing.xl};
      text-align: center;
    `,text:r.css`
      margin-bottom: ${e.spacing.md};
    `,button:r.css`
      margin: ${e.spacing.md} 0 ${e.spacing.sm};
    `});var me,ve,he,xe;const fe=e=>{let{onChange:a,onRootRouteEdit:t,receivers:r,routes:i,readOnly:s=!1}=e;const[o,c]=(0,n.useState)(i.routes),[u,d]=(0,n.useState)(!1),p=(0,l.useStyles2)(je),g=()=>{d(!0),c((e=>[...e,Object.assign({},y,{matchers:[b]})]))};return(0,T.jsxs)("div",{className:p.container,children:[me||(me=(0,T.jsx)("h5",{children:"Specific routing"})),ve||(ve=(0,T.jsx)("p",{children:"Send specific alerts to chosen contact points, based on matching criteria"})),i.receiver?o.length>0?(0,T.jsxs)(T.Fragment,{children:[!u&&!s&&(0,T.jsx)(l.Button,{className:p.addMatcherBtn,icon:"plus",onClick:g,type:"button",children:"New policy"}),(0,T.jsx)(de,{isAddMode:u,readOnly:s,onCancelAdd:()=>{d(!1),c((e=>{const a=[...e];return a.pop(),a}))},onChange:e=>{a(Object.assign({},i,{routes:e})),u&&d(!1)},receivers:r,routes:o})]}):s?xe||(xe=(0,T.jsx)(Z,{children:(0,T.jsx)("p",{children:"There are no specific policies configured."})})):(0,T.jsx)(pe,{buttonIcon:"plus",buttonLabel:"New specific policy",onButtonClick:g,text:"You haven't created any specific policies yet."}):s?he||(he=(0,T.jsx)(Z,{children:(0,T.jsx)("p",{children:"There is no default contact point configured for the root route."})})):(0,T.jsx)(pe,{buttonIcon:"rocket",buttonLabel:"Set a default contact point",onButtonClick:t,text:"You haven't set a default contact point for the root route yet."})]})},je=e=>({container:r.css`
      display: flex;
      flex-flow: column nowrap;
    `,addMatcherBtn:r.css`
      align-self: flex-end;
      margin-bottom: ${e.spacing(3.5)};
    `});var be,ye,Ce=t("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),Se=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),Ie=t("./public/app/features/alerting/unified/state/actions.ts"),_e=t("./public/app/features/alerting/unified/utils/redux.ts");const Ve=(0,l.withErrorBoundary)((()=>{var e;const a=(0,i.useDispatch)(),t=(0,l.useStyles2)(Ne),[r,d]=(0,n.useState)(!1),[p,g]=(0,Ce.k)(),m=!p||(0,v.RY)(p),h=(0,Se._)((e=>e.amConfigs)),x=(0,n.useCallback)((()=>{p&&a((0,Ie.Yh)(p))}),[p,a]);(0,n.useEffect)((()=>{x()}),[x]);const{result:f,loading:j,error:b}=p&&h[p]||_e.oq,y=null==f?void 0:f.alertmanager_config,[I,V]=(0,n.useMemo)((()=>C(null==y?void 0:y.route)),[null==y?void 0:y.route]),N=_((null!==(e=null==y?void 0:y.receivers)&&void 0!==e?e:[]).map((e=>e.name))),$=()=>{d(!0)},k=()=>{d(!1)};(0,o.x)((e=>e.unifiedAlerting.saveAMConfig));const w=e=>{if(!f)return;const t=S(p,Object.assign({},I,e),V);r&&k(),a((0,Ie.mM)({newConfig:Object.assign({},f,{alertmanager_config:Object.assign({},f.alertmanager_config,{route:t})}),oldConfig:f,alertManagerSourceName:p,successMessage:"Saved",refetch:!0}))};return p?(0,T.jsxs)(c.J,{pageId:"am-routes",children:[(0,T.jsx)(u.P,{current:p,onChange:g}),b&&!j&&(0,T.jsx)(l.Alert,{severity:"error",title:"Error loading Alertmanager config",children:b.message||"Unknown error."}),j&&(ye||(ye=(0,T.jsx)(l.LoadingPlaceholder,{text:"Loading Alertmanager config..."}))),f&&!j&&!b&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(L,{alertManagerSourceName:p,isEditMode:r,onSave:w,onEnterEditMode:$,onExitEditMode:k,receivers:N,routes:I}),(0,T.jsx)("div",{className:t.break}),(0,T.jsx)(fe,{onChange:w,readOnly:m,onRootRouteEdit:$,receivers:N,routes:I})]})]}):be||(be=(0,T.jsx)(s.l_,{to:"/alerting/routes"}))}),{style:"page"}),Ne=e=>({break:r.css`
    width: 100%;
    height: 0;
    margin-bottom: ${e.spacing(2)};
  `})},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,a,t)=>{t.d(a,{J:()=>s});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./public/app/core/components/Page/Page.tsx"),r=t("./public/app/core/selectors/navModel.ts"),l=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),i=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const s=e=>{let{children:a,pageId:t,isLoading:s}=e;const o=(0,r.h)((0,l.useSelector)((e=>e.navIndex)),t);return(0,i.jsx)(n.Z,{navModel:o,children:(0,i.jsx)(n.Z.Contents,{isLoading:s,children:a})})}},"./public/app/features/alerting/unified/components/silences/Matchers.tsx":(e,a,t)=>{t.d(a,{g:()=>c});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./packages/grafana-ui/src/index.ts"),l=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=t("./public/app/features/alerting/unified/components/AlertLabel.tsx"),s=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),o=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const c=e=>{let{matchers:a,onRemoveLabel:t}=e;const l=(0,r.useStyles)(u),c=(0,n.useCallback)((e=>{t&&t(e)}),[t]);return(0,o.jsx)("div",{className:l.wrapper,children:a.map(((e,a)=>{const{name:n,value:r}=e;return(0,o.jsx)(i.i,{labelKey:n,value:r,operator:(0,s.zy)(e),onRemoveLabel:t?()=>c(a):void 0},`${n}-${r}-${a}`)}))})},u=e=>({wrapper:l.css`
    & > * {
      margin-top: ${e.spacing.xs};
      margin-right: ${e.spacing.xs};
    }
    padding-bottom: ${e.spacing.xs};
  `})},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,a,t)=>{t.d(a,{k:()=>c});var n=t("./public/app/core/hooks/useQueryParams.ts"),r=t("./public/app/core/store.ts"),l=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=t("./public/app/features/alerting/unified/utils/constants.ts"),s=t("./public/app/features/alerting/unified/utils/datasource.ts");function o(e){return e===s.GC||!!(0,s.aM)().find((a=>a.name===e))}function c(){const[e,a]=(0,n.K)(),t=(0,l.useCallback)((e=>{o(e)&&(e===s.GC?(r.Z.delete(i.de),a({[i.c4]:null})):(r.Z.set(i.de,e),a({[i.c4]:e})))}),[a]),c=e[i.c4];if(c&&"string"==typeof c)return o(c)?[c,t]:[void 0,t];const u=r.Z.get(i.de);return u&&"string"==typeof u&&o(u)?(t(u),[u,t]):[s.GC,t]}}}]);
//# sourceMappingURL=AlertAmRoutes.44e4de8a0bb9f2fbf136.js.map