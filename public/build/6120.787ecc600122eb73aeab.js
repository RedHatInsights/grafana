"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6120],{"./public/app/features/alerting/unified/components/AnnotationDetailsField.tsx":(e,a,t)=>{t.d(a,{a:()=>u});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./public/app/features/alerting/unified/components/Well.tsx"),s=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=t("./packages/grafana-ui/src/index.ts"),i=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),o=t("./public/app/features/alerting/unified/utils/constants.ts"),l=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const c=["message","description"],u=({annotationKey:e,value:a})=>{const t=o.vY[e]?(0,l.jsx)(r.Tooltip,{content:e,placement:"top",theme:"info",children:(0,l.jsx)("span",{children:o.vY[e]})}):e;return(0,l.jsx)(i.C,{label:t,horizontal:!0,children:(0,l.jsx)(d,{annotationKey:e,value:a})})},d=({annotationKey:e,value:a})=>{const t=(0,r.useStyles)(p);return c.includes(e)?(0,l.jsx)(n.t,{children:a}):a&&a.startsWith("http")?(0,l.jsx)("a",{href:a,target:"__blank",className:t.link,children:a}):(0,l.jsx)(l.Fragment,{children:a})},p=e=>({well:s.css`
    word-break: break-all;
  `,link:s.css`
    word-break: break-all;
    color: ${e.colors.textBlue};
  `})},"./public/app/features/alerting/unified/components/DetailsField.tsx":(e,a,t)=>{t.d(a,{C:()=>i});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./packages/grafana-ui/src/index.ts"),r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const i=({className:e,label:a,horizontal:t,children:i})=>{const l=(0,s.useStyles2)(o);return(0,r.jsxs)("div",{className:(0,n.cx)(e,l.field,t?l.fieldHorizontal:l.fieldVertical),children:[(0,r.jsx)("div",{children:a}),(0,r.jsx)("div",{children:i})]})},o=e=>({fieldHorizontal:n.css`
    flex-direction: row;
    ${e.breakpoints.down("md")} {
      flex-direction: column;
    }
  `,fieldVertical:n.css`
    flex-direction: column;
  `,field:n.css`
    display: flex;
    margin: ${e.spacing(2)} 0;

    & > div:first-child {
      width: 110px;
      padding-right: ${e.spacing(1)};
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.fontWeightBold};
      line-height: 1.8;
    }
    & > div:nth-child(2) {
      flex: 1;
      color: ${e.colors.text.secondary};
    }
  `})},"./public/app/features/alerting/unified/components/DynamicTable.tsx":(e,a,t)=>{t.d(a,{t:()=>o});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=t("./packages/grafana-ui/src/index.ts"),i=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const o=({cols:e,items:a,isExpandable:t=!1,onCollapse:o,onExpand:c,isExpanded:u,renderExpandedContent:d,testIdGenerator:p,renderPrefixCell:m,renderPrefixHeader:f})=>{if((o||c||u)&&!(o&&c&&u))throw new Error("either all of onCollapse, onExpand, isExpanded must be provided, or none");if((t||d)&&(!t||!d))throw new Error("either both isExpanded and renderExpandedContent must be provided, or neither");const g=(0,r.useStyles2)(l(e,t,!!f)),[x,h]=(0,n.useState)([]);return(0,i.jsxs)("div",{className:g.container,"data-testid":"dynamic-table",children:[(0,i.jsxs)("div",{className:g.row,"data-testid":"header",children:[f&&f(),t&&(0,i.jsx)("div",{className:g.cell}),e.map((e=>(0,i.jsx)("div",{className:g.cell,children:e.label},e.id)))]}),a.map(((n,l)=>{var f;const b=u?u(n):x.includes(n.id);return(0,i.jsxs)("div",{className:g.row,"data-testid":null!==(f=null==p?void 0:p(n,l))&&void 0!==f?f:"row",children:[m&&m(n,l,a),t&&(0,i.jsx)("div",{className:(0,s.cx)(g.cell,g.expandCell),children:(0,i.jsx)(r.IconButton,{"aria-label":(b?"Collapse":"Expand")+" row",size:"xl","data-testid":"collapse-toggle",className:g.expandButton,name:b?"angle-down":"angle-right",onClick:()=>(e=>{u&&o&&c?u(e)?o(e):c(e):h(x.includes(e.id)?x.filter((a=>a!==e.id)):[...x,e.id])})(n),type:"button"})}),e.map((e=>(0,i.jsx)("div",{className:(0,s.cx)(g.cell,g.bodyCell),"data-column":e.label,children:e.renderCell(n,l)},`${n.id}-${e.id}`))),b&&d&&(0,i.jsx)("div",{className:g.expandedContentRow,"data-testid":"expanded-content",children:d(n,l,a)})]},n.id)}))]})},l=(e,a,t)=>{const n=e.map((e=>e.size?"number"==typeof e.size?`${e.size}fr`:e.size:"auto"));return a&&n.unshift("calc(1em + 16px)"),t&&n.unshift("0"),e=>({container:s.css`
      border: 1px solid ${e.colors.border.strong};
      border-radius: 2px;
      color: ${e.colors.text.secondary};
    `,row:s.css`
      display: grid;
      grid-template-columns: ${n.join(" ")};
      grid-template-rows: 1fr auto;

      &:nth-child(2n + 1) {
        background-color: ${e.colors.background.secondary};
      }

      &:nth-child(2n) {
        background-color: ${e.colors.background.primary};
      }

      ${e.breakpoints.down("sm")} {
        grid-template-columns: auto 1fr;
        grid-template-areas: 'left right';
        padding: 0 ${e.spacing(.5)};

        &:first-child {
          display: none;
        }

        ${t?"\n            & > *:first-child {\n              display: none;\n            }\n          ":""}
      }
    `,cell:s.css`
      align-items: center;
      padding: ${e.spacing(1)};

      ${e.breakpoints.down("sm")} {
        padding: ${e.spacing(1)} 0;
        grid-template-columns: 1fr;
      }
    `,bodyCell:s.css`
      overflow: hidden;
      word-break: break-all;
      ${e.breakpoints.down("sm")} {
        grid-column-end: right;
        grid-column-start: right;

        &::before {
          content: attr(data-column);
          display: block;
          color: ${e.colors.text.primary};
        }
      }
    `,expandCell:s.css`
      justify-content: center;

      ${e.breakpoints.down("sm")} {
        align-items: start;
        grid-area: left;
      }
    `,expandedContentRow:s.css`
      grid-column-end: ${n.length+1};
      grid-column-start: ${t?3:2};
      grid-row: 2;
      padding: 0 ${e.spacing(3)} 0 ${e.spacing(1)};
      position: relative;

      ${e.breakpoints.down("sm")} {
        grid-column-start: 2;
        border-top: 1px solid ${e.colors.border.strong};
        grid-row: auto;
        padding: ${e.spacing(1)} 0 0 0;
      }
    `,expandButton:s.css`
      margin-right: 0;
      display: block;
    `})}},"./public/app/features/alerting/unified/components/Well.tsx":(e,a,t)=>{t.d(a,{t:()=>i});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./packages/grafana-ui/src/index.ts"),s=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const i=({children:e,className:a})=>{const t=(0,n.useStyles)(o);return(0,r.jsx)("div",{className:(0,s.cx)(t.wrapper,a),children:e})},o=e=>({wrapper:s.css`
    background-color: ${e.colors.panelBg};
    border: solid 1px ${e.colors.formInputBorder};
    border-radius: ${e.border.radius.sm};
    padding: ${e.spacing.xs} ${e.spacing.sm};
    font-family: ${e.typography.fontFamily.monospace};
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsActionButtons.tsx":(e,a,t)=>{t.d(a,{f:()=>I});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),r=t("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),i=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),o=t("./packages/grafana-data/src/index.ts"),l=t("./packages/grafana-runtime/src/index.ts"),c=t("./packages/grafana-ui/src/index.ts"),u=t("./public/app/core/services/context_srv.ts"),d=t("./public/app/core/core.ts"),p=t("./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts"),m=t("./public/app/features/alerting/unified/utils/constants.ts"),f=t("./public/app/features/alerting/unified/utils/datasource.ts"),g=t("./public/app/features/alerting/unified/utils/misc.ts"),x=t("./public/app/features/alerting/unified/utils/rule-id.ts"),h=t("./public/app/features/alerting/unified/state/actions.ts"),b=t("./public/app/features/alerting/unified/utils/alertmanager.ts"),j=t("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),v=t("./public/app/features/alerting/unified/components/DynamicTable.tsx"),y=t("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx"),_=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");var z,k=t("./public/app/features/alerting/unified/components/AlertLabel.tsx"),w=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const S=({alertId:e})=>{const{loading:a,error:t,result:r=[]}=function(e){const a=(0,s.useDispatch)(),t=(0,_._)((e=>e.managedAlertStateHistory));return(0,n.useEffect)((()=>{a((0,h.Ms)(e))}),[a,e]),t}(e);if(a&&!t)return z||(z=(0,w.jsx)(c.LoadingPlaceholder,{text:"Loading history..."}));if(t&&!a)return(0,w.jsx)(c.Alert,{title:"Failed to fetch alert state history",children:t.message});const i=[{id:"state",label:"State",size:"max-content",renderCell:C},{id:"value",label:"",size:"auto",renderCell:$},{id:"timestamp",label:"Time",size:"max-content",renderCell:R}],o=r.reduce(((e,a,t)=>(e.push({id:String(a.id),state:a.newState,text:a.text,data:a.data,timestamp:a.updated}),function(e,a){const t=a[e],n=a[e+1];if(!n)return!1;return n.newState===t.prevState}(t,r)||e.push({id:(0,j.uniqueId)(),state:a.prevState}),e)),[]).map((e=>({id:e.id,data:e})));return(0,w.jsx)(v.t,{cols:i,items:o})};function $(e){var a,t;const n=null!==(a=null===(t=e.data.data)||void 0===t?void 0:t.evalMatches)&&void 0!==a?a:[];return(0,w.jsxs)(w.Fragment,{children:[e.data.text,(0,w.jsx)(E,{children:n.map((e=>(0,w.jsx)(k.i,{labelKey:e.metric,value:String(e.value)},e.metric)))})]})}function C(e){return(0,w.jsx)(y.l,{state:e.data.state})}function R(e){return(0,w.jsx)("div",{className:N,children:e.data.timestamp&&(0,w.jsx)("span",{children:(0,o.dateTimeFormat)(e.data.timestamp)})})}const E=({children:e})=>{const{wrapper:a}=(0,c.useStyles)(D);return(0,w.jsx)("div",{className:a,children:e})},N=i.css`
  display: flex;
  align-items: flex-end;
  flex-direction: column;
`,D=e=>({wrapper:i.css`
    & > * {
      margin-right: ${e.spacing.xs};
    }
  `});var q,F;const I=({rule:e,rulesSource:a})=>{var t,i;const j=(0,s.useDispatch)(),v=(0,r.TH)(),y=(0,c.useStyles2)(M),{namespace:_,group:z,rulerRule:k}=e,[$,C]=(0,n.useState)(),R=function(e){if(!e)return!1;return null!=e.grafana_alert}(e.rulerRule)&&null!==(t=e.rulerRule.grafana_alert.id)&&void 0!==t?t:"",{StateHistoryModal:E,showStateHistoryModal:N}=function(e){var a;const[t,s]=(0,n.useState)(!1);return{StateHistoryModal:(0,n.useMemo)((()=>(0,w.jsx)(c.Modal,{isOpen:t,onDismiss:()=>s(!1),closeOnBackdropClick:!0,closeOnEscape:!0,title:"State history",children:a||(a=(0,w.jsx)(S,{alertId:e}))})),[e,t]),showStateHistoryModal:()=>s(!0),hideStateHistoryModal:()=>s(!1)}}(R),D=(0,f.HY)(a)?a:null===(i=(0,b.Xy)(a.jsonData.alertmanagerUid))||void 0===i?void 0:i.name,I=[],U=[],{isEditable:A}=(0,p.M)((0,f.EG)(a),k),B=v.pathname+v.search,H=v.pathname.endsWith("/view");const L=()=>{if($&&$.rulerRule){const e=x.Zk((0,f.EG)($.namespace.rulesSource),$.namespace.name,$.group.name,$.rulerRule);j((0,h.hS)(e,{navigateTo:H?"/alerting/list":void 0})),C(void 0)}},T=()=>{if((0,f.jq)(a)){const t=`${encodeURIComponent(a.name)}/${encodeURIComponent(e.name)}`;return`${l.config.appUrl}${l.config.appSubUrl}/alerting/${t}/find`}return window.location.href.split("?")[0]};if((0,f.jq)(a)&&u.Vt.isEditor&&I.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"primary",icon:"chart-line",target:"__blank",href:(0,g.mH)(a.name,e.query),children:"See graph"},"explore")),e.annotations[m.q6.runbookURL]&&I.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"primary",icon:"book",target:"__blank",href:e.annotations[m.q6.runbookURL],children:"View runbook"},"runbook")),e.annotations[m.q6.dashboardUID]){const a=e.annotations[m.q6.dashboardUID];if(a){I.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(a)}`,children:"Go to dashboard"},"dashboard"));const t=e.annotations[m.q6.panelID];t&&I.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(a)}?viewPanel=${encodeURIComponent(t)}`,children:"Go to panel"},"panel"))}}if(D&&I.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",icon:"bell-slash",target:"__blank",href:(0,g.Vv)(D,e),children:"Silence"},"silence")),R&&I.push((0,w.jsxs)(n.Fragment,{children:[(0,w.jsx)(c.Button,{className:y.button,size:"xs",icon:"history",onClick:()=>N(),children:"Show state history"}),E]},"history")),H||U.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"secondary",icon:"eye",href:(0,g.V2)(a,e,B),children:"View"},"view")),A&&k){const t=(0,f.EG)(a),n=x.Zk(t,_.name,z.name,k),s=o.urlUtil.renderUrl(`${l.config.appSubUrl}/alerting/${encodeURIComponent(x.$V(n))}/edit`,{returnTo:B});H&&U.push((0,w.jsx)(c.ClipboardButton,{onClipboardCopy:()=>{d.h$.emit(o.AppEvents.alertSuccess,["URL copied!"])},onClipboardError:e=>{d.h$.emit(o.AppEvents.alertError,["Error while copying URL",e.text])},className:y.button,size:"sm",getText:T,children:"Copy link to rule"},"copy")),U.push((0,w.jsx)(c.LinkButton,{className:y.button,size:"xs",variant:"secondary",icon:"pen",href:s,children:"Edit"},"edit"),(0,w.jsx)(c.Button,{className:y.button,size:"xs",type:"button",variant:"secondary",icon:"trash-alt",onClick:()=>C(e),children:"Delete"},"delete"))}return I.length||U.length?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:y.wrapper,children:[(0,w.jsx)(c.HorizontalGroup,{width:"auto",children:I.length?I:q||(q=(0,w.jsx)("div",{}))}),(0,w.jsx)(c.HorizontalGroup,{width:"auto",children:U.length?U:F||(F=(0,w.jsx)("div",{}))})]}),!!$&&(0,w.jsx)(c.ConfirmModal,{isOpen:!0,title:"Delete rule",body:"Deleting this rule will permanently remove it from your alert rule list. Are you sure you want to delete this rule?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:L,onDismiss:()=>C(void 0)})]}):null};const M=e=>({wrapper:i.css`
    padding: ${e.spacing(2)} 0;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    flex-wrap: wrap;
    border-bottom: solid 1px ${e.colors.border.medium};
  `,button:i.css`
    height: 24px;
    margin-top: ${e.spacing(1)};
    font-size: ${e.typography.size.sm};
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsAnnotations.tsx":(e,a,t)=>{t.d(a,{J:()=>o});t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./packages/grafana-ui/src/index.ts"),r=t("./public/app/features/alerting/unified/components/AnnotationDetailsField.tsx"),i=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function o(e){const{annotations:a}=e,t=(0,s.useStyles2)(l);return 0===a.length?null:(0,i.jsx)("div",{className:t.annotations,children:a.map((([e,a])=>(0,i.jsx)(r.a,{annotationKey:e,value:a},e)))})}const l=()=>({annotations:n.css`
    margin-top: 46px;
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsDataSources.tsx":(e,a,t)=>{t.d(a,{C:()=>p});var n=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),s=t("./packages/grafana-runtime/src/index.ts"),r=t("./packages/grafana-ui/src/index.ts"),i=t("./public/app/features/expressions/ExpressionDatasource.ts"),o=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),l=t("./public/app/features/alerting/unified/utils/datasource.ts"),c=t("./public/app/features/alerting/unified/utils/rules.ts"),u=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),d=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function p(e){const{rulesSource:a,rule:t}=e,n=(0,r.useStyles2)(m),p=(0,o.useMemo)((()=>{if((0,l.jq)(a))return[{name:a.name,icon:a.meta.info.logos.small}];if((0,c.Pc)(t.rulerRule)){const{data:e}=t.rulerRule.grafana_alert,a=e.reduce(((e,a)=>{const t=(0,s.getDataSourceSrv)().getInstanceSettings(a.datasourceUid);return t&&t.uid!==i.Yq?(e[t.name]={name:t.name,icon:t.meta.info.logos.small},e):e}),{});return Object.values(a)}return[]}),[t,a]);return 0===p.length?null:(0,d.jsx)(u.C,{label:"Data source",children:p.map((({name:e,icon:a},t)=>(0,d.jsxs)("div",{children:[a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("img",{alt:`${e} datasource logo`,className:n.dataSourceIcon,src:a})," "]}),e]},e)))})}function m(e){const a=e.spacing(2);return{dataSourceIcon:n.css`
      width: ${a};
      height: ${a};
    `}}},"./public/app/features/alerting/unified/components/rules/RuleDetailsExpression.tsx":(e,a,t)=>{t.d(a,{C:()=>h});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=t("./public/app/features/alerting/unified/utils/datasource.ts"),i=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),o=t("./.yarn/__virtual__/@grafana-slate-react-virtual-13c8a80c0a/0/cache/@grafana-slate-react-npm-0.22.10-grafana-510bc0576d-3417c53d9d.zip/node_modules/@grafana/slate-react/lib/slate-react.es.js"),l=t("./public/app/plugins/datasource/prometheus/promql.ts"),c=t("./public/app/plugins/datasource/loki/syntax.ts"),u=t("./.yarn/cache/prismjs-npm-1.25.0-8d60169ac0-04d8eae9d1.zip/node_modules/prismjs/prism.js"),d=t("./packages/grafana-ui/src/index.ts"),p=t("./public/app/features/alerting/unified/components/Well.tsx"),m=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const f=({language:e,expr:a})=>{const t=(0,n.useMemo)((()=>[(0,d.SlatePrism)({onlyIn:e=>"code_block"===e.type,getSyntax:()=>e},Object.assign({},u.languages,{[e]:"logql"===e?c.ZP:l.ZP}))]),[e]),s=(0,n.useMemo)((()=>(0,d.makeValue)(a)),[a]);return(0,m.jsx)(o.ML,{plugins:t,value:s,readOnly:!0})},g=({expression:e,rulesSource:a})=>{const t=(0,d.useStyles)(x);return(0,m.jsx)(p.t,{className:(0,s.cx)(t.well,"slate-query-field"),children:(0,r.jq)(a)?(0,m.jsx)(f,{expr:e,language:a.type===r.ye.Loki?"logql":"promql"}):e})},x=e=>({well:s.css`
    font-family: ${e.typography.fontFamily.monospace};
  `});function h(e){const{annotations:a,rulesSource:t,rule:n}=e,o=b();return(0,r.jq)(t)?(0,m.jsx)(i.C,{label:"Expression",horizontal:!0,className:(0,s.cx)({[o.exprRow]:!!a.length}),children:(0,m.jsx)(g,{expression:n.query,rulesSource:t})}):null}const b=()=>({exprRow:s.css`
    margin-bottom: 46px;
  `})},"./public/app/features/alerting/unified/components/rules/RuleDetailsMatchingInstances.tsx":(e,a,t)=>{t.d(a,{M:()=>f});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=t("./public/app/features/alerting/unified/utils/rules.ts"),r=t("./public/app/features/alerting/unified/components/DetailsField.tsx"),i=(t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),t("./public/app/features/alerting/unified/components/AlertLabels.tsx")),o=t("./public/app/features/alerting/unified/components/AnnotationDetailsField.tsx"),l=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const c=({instance:e})=>{const a=(Object.entries(e.annotations||{})||[]).filter((([e,a])=>!!a.trim()));return(0,l.jsxs)("div",{children:[e.value&&(0,l.jsx)(r.C,{label:"Value",horizontal:!0,children:e.value}),a.map((([e,a])=>(0,l.jsx)(o.a,{annotationKey:e,value:a},e)))]})};var u=t("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx"),d=t("./public/app/features/alerting/unified/components/DynamicTable.tsx");const p=({instances:e})=>{const a=(0,n.useMemo)((()=>e.map((e=>({data:e,id:(0,s.pB)(e)}))).sort(((e,a)=>e.id.localeCompare(a.id)))),[e]);return(0,l.jsx)(d.t,{cols:m,isExpandable:!0,items:a,renderExpandedContent:({data:e})=>(0,l.jsx)(c,{instance:e})})},m=[{id:"state",label:"State",renderCell:({data:{state:e}})=>(0,l.jsx)(u.l,{state:e}),size:"80px"},{id:"labels",label:"Labels",renderCell:({data:{labels:e}})=>(0,l.jsx)(i.s,{labels:e})},{id:"created",label:"Created",renderCell:({data:{activeAt:e}})=>(0,l.jsx)(l.Fragment,{children:e.startsWith("0001")?"-":e.substr(0,19).replace("T"," ")}),size:"150px"}];function f(e){var a;const{promRule:t}=e;return(0,s.x_)(t)&&null!==(a=t.alerts)&&void 0!==a&&a.length?(0,l.jsx)(r.C,{label:"Matching instances",horizontal:!0,children:(0,l.jsx)(p,{instances:t.alerts})}):null}},"./public/app/features/alerting/unified/components/rules/RuleHealth.tsx":(e,a,t)=>{t.d(a,{V:()=>l});var n,s,r=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=t("./packages/grafana-ui/src/index.ts"),o=(t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js"));const l=({rule:e})=>{const a=(0,i.useStyles2)(c);return"err"===e.health||"error"===e.health?(0,o.jsx)(i.Tooltip,{theme:"error",content:e.lastError||"No error message provided.",children:(0,o.jsxs)("div",{className:a.warn,children:[n||(n=(0,o.jsx)(i.Icon,{name:"exclamation-triangle"})),s||(s=(0,o.jsx)("span",{children:"error"}))]})}):(0,o.jsx)(o.Fragment,{children:e.health})},c=e=>({warn:r.css`
    display: inline-flex;
    flex-direction: row;
    color: ${e.colors.warning.text};
    & > * + * {
      margin-left: ${e.spacing(1)};
    }
  `})},"./public/app/features/alerting/unified/components/rules/RuleState.tsx":(e,a,t)=>{t.d(a,{p:()=>m});var n,s,r=t("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=t("./packages/grafana-data/src/index.ts"),o=t("./packages/grafana-ui/src/index.ts"),l=t("./public/app/types/unified-alerting-dto.ts"),c=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),u=t("./public/app/features/alerting/unified/utils/rules.ts"),d=t("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx"),p=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const m=({rule:e,isDeleting:a,isCreating:t})=>{const r=(0,o.useStyles2)(f),{promRule:m}=e,g=(0,c.useMemo)((()=>{var e;if(m&&(0,u.x_)(m)&&null!==(e=m.alerts)&&void 0!==e&&e.length&&m.state!==l.x_.Inactive){const e=(0,u.ub)(m);if(e)return(0,p.jsxs)("span",{title:String(e),className:r.for,children:["for"," ",(0,i.intervalToAbbreviatedDurationString)({start:e,end:new Date},!1)]})}return null}),[m,r]);return a?n||(n=(0,p.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[(0,p.jsx)(o.Spinner,{}),"deleting"]})):t?s||(s=(0,p.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[" ",(0,p.jsx)(o.Spinner,{}),"creating"]})):m&&(0,u.x_)(m)?(0,p.jsxs)(o.HorizontalGroup,{align:"flex-start",children:[(0,p.jsx)(d.l,{state:m.state}),g]}):m&&(0,u.OP)(m)?(0,p.jsx)(p.Fragment,{children:"Recording rule"}):(0,p.jsx)(p.Fragment,{children:"n/a"})},f=e=>({for:r.css`
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    padding-top: 2px;
  `})},"./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts":(e,a,t)=>{t.d(a,{Z:()=>o});var n=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=t("./public/app/features/alerting/unified/utils/datasource.ts"),r=t("./public/app/features/alerting/unified/utils/rules.ts"),i=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function o(e){const a=(0,i._)((e=>e.promRules)),t=(0,i._)((e=>e.rulerRules)),o=(0,n.useRef)({}),c=(0,n.useMemo)((()=>{if(e){const a=(0,s.o_)(e);if(!a)throw new Error(`Unknown rules source: ${e}`);return[a]}return(0,s.h_)()}),[e]);return(0,n.useMemo)((()=>c.map((e=>{var n,i;const c=(0,s.jq)(e)?e.name:e,u=null===(n=a[c])||void 0===n?void 0:n.result,d=null===(i=t[c])||void 0===i?void 0:i.result,p=o.current[c];if(p&&p.promRules===u&&p.rulerRules===d)return p.result;const m={};Object.entries(d||{}).forEach((([a,t])=>{const n={rulesSource:e,name:a,groups:[]};m[a]=n,function(e,a){e.groups=a.map((a=>{const t={name:a.name,interval:a.interval,rules:[]};return t.rules=a.rules.map((a=>function(e,a,t){return(0,r.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:t}:(0,r.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:a,group:t}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:t}}(a,e,t))),t}))}(n,t)})),null==u||u.forEach((({name:a,groups:t})=>{!function(e,a){a.forEach((a=>{var t;let n=e.groups.find((e=>e.name===a.name));n||(n={name:a.name,rules:[]},e.groups.push(n)),(null!==(t=a.rules)&&void 0!==t?t:[]).forEach((a=>{const t=function(e,a,t){var n;if((0,s.HY)(t))return a.rules.find((a=>a.name===e.name));return null!==(n=a.rules.find((a=>!a.promRule&&l(a,e,!0))))&&void 0!==n?n:a.rules.find((a=>!a.promRule&&l(a,e,!1)))}(a,n,e.rulesSource);t?t.promRule=a:n.rules.push(function(e,a,t){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,r.x_)(e)&&e.annotations||{},promRule:e,namespace:a,group:t}}(a,e,n))}))}))}(m[a]=m[a]||{rulesSource:e,name:a,groups:[]},t)}));const f=Object.values(m);return(0,s.HY)(e)&&f.forEach((e=>{e.groups=[{name:"default",rules:e.groups.flatMap((e=>e.rules)).sort(((e,a)=>e.name.localeCompare(a.name)))}]})),o.current[c]={promRules:u,rulerRules:d,result:f},f})).flat()),[a,t,c])}function l(e,a,t=!0){return e.name===a.name&&JSON.stringify([t?c(e.query):"",e.labels,e.annotations])===JSON.stringify([t?c(a.query):"",a.labels||{},(0,r.x_)(a)&&a.annotations||{}])}function c(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.substr(1,e.length-2)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},"./public/app/features/alerting/unified/hooks/useFolder.ts":(e,a,t)=>{t.d(a,{W:()=>l});var n=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),s=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),r=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=t("./public/app/features/alerting/unified/state/actions.ts"),o=t("./public/app/features/alerting/unified/utils/redux.ts");function l(e){const a=(0,n.useDispatch)(),t=(0,s._)((e=>e.folders));if((0,r.useEffect)((()=>{e&&a((0,i.sw)(e))}),[a,e]),e){const a=t[e]||o.oq;return{folder:a.result,loading:a.loading}}return{loading:!1}}},"./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts":(e,a,t)=>{t.d(a,{M:()=>d});var n=t("./public/app/core/services/context_srv.ts"),s=t("./public/app/features/alerting/unified/utils/rules.ts"),r=t("./public/app/features/alerting/unified/hooks/useFolder.ts"),i=t("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),o=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),l=t("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),c=t("./public/app/features/alerting/unified/state/actions.ts"),u=t("./public/app/features/alerting/unified/utils/datasource.ts");function d(e,a){var t,d;const p=(0,i._)((e=>e.lotexSupportsRuleEditing)),m=(0,o.useDispatch)(),f=a&&(0,s.Pc)(a)?a.grafana_alert.namespace_uid:void 0,{folder:g,loading:x}=(0,r.W)(f);if((0,l.useEffect)((()=>{void 0===p[e]&&e!==u.GC&&m((0,c.Yb)(e))}),[e,p,m]),!a)return{isEditable:!1,loading:!1};if((0,s.Pc)(a)){if(!f)throw new Error(`Rule ${a.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`);return{isEditable:null==g?void 0:g.canSave,loading:x}}return{isEditable:n.Vt.isEditor&&!(null===(t=p[e])||void 0===t||!t.result),loading:!(null===(d=p[e])||void 0===d||!d.loading)}}}}]);
//# sourceMappingURL=6120.787ecc600122eb73aeab.js.map