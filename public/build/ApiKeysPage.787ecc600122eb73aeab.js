"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3082],{"./public/app/features/api-keys/ApiKeysPage.tsx":(e,s,n)=>{n.r(s),n.d(s,{ApiKeysPageUnconnected:()=>H,default:()=>W});var t=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=n("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/0/cache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),a=n("./public/app/core/selectors/navModel.ts");const r=e=>e.includeExpired?e.keysIncludingExpired.length:e.keys.length,o=e=>{const s=RegExp(e.searchQuery,"i");return(e.includeExpired?e.keysIncludingExpired:e.keys).filter((e=>s.test(e.name)||s.test(e.role)))},l=e=>e.includeExpired,c=e=>0===e.keys.length&&e.keysIncludingExpired.length>0;var d=n("./public/app/core/services/backend_srv.ts"),p=n("./public/app/features/api-keys/state/reducers.ts");function u(){return async e=>{e((0,p.dF)());const[s,n]=await Promise.all([(0,d.i)().get("/api/auth/keys?includeExpired=false"),(0,d.i)().get("/api/auth/keys?includeExpired=true")]);e((0,p.iK)({keys:s,keysIncludingExpired:n}))}}var h,y,x=n("./public/app/core/components/Page/Page.tsx"),m=n("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/0/cache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),g=n("./packages/grafana-ui/src/index.ts"),f=n("./.yarn/cache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function j({onDismiss:e,apiKey:s,rootPath:n}){const t=(0,g.useStyles2)(b);return(0,f.jsxs)(g.Modal,{title:"API Key Created",onDismiss:e,onClickBackdrop:e,isOpen:!0,children:[(0,f.jsx)(g.Field,{label:"Key",children:(0,f.jsx)("span",{className:t.label,children:s})}),h||(h=(0,f.jsx)(g.Alert,{severity:"info",title:"You will only be able to view this key here once!",children:"It is not stored in this form, so be sure to copy it now."})),y||(y=(0,f.jsx)("p",{className:"text-muted",children:"You can authenticate a request using the Authorization HTTP header, example:"})),(0,f.jsxs)("pre",{className:t.small,children:['curl -H "Authorization: Bearer ',s,'" ',n,"/api/dashboards/home"]})]})}function b(e){return{label:m.css`
      padding: ${e.spacing(1)};
      background-color: ${e.colors.background.secondary};
      border-radius: ${e.shape.borderRadius()};
    `,small:m.css`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.bodySmall.fontWeight};
    `}}var v,k,A,C=n("./public/app/core/config.ts"),K=n("./public/app/core/app_events.ts"),w=n("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),I=n("./packages/grafana-data/src/index.ts"),E=n("./public/app/features/profile/state/selectors.ts"),S=n("./public/app/types/index.ts"),N=n("./public/app/core/components/Animations/SlideDown.tsx"),P=n("./public/app/core/components/CloseButton/CloseButton.tsx");const{Input:T}=g.LegacyForms,D=Object.keys(S.B5).map((e=>({label:e,value:e})));function _(e){if(!e)return!0;try{return I.rangeUtil.intervalToSeconds(e),!0}catch{}return!1}const F={[g.EventsWithValidation.onBlur]:[{rule:_,errorMessage:"Not a valid duration"}]},Z=({show:e,onClose:s,onKeyAdded:n})=>{const[i,a]=(0,t.useState)(""),[r,o]=(0,t.useState)(S.B5.Viewer),[l,c]=(0,t.useState)("");(0,t.useEffect)((()=>{a(""),o(S.B5.Viewer),c("")}),[e]);return(0,f.jsx)(N.s,{in:e,children:(0,f.jsxs)("div",{className:"gf-form-inline cta-form",children:[(0,f.jsx)(P.P,{onClick:s}),(0,f.jsxs)("form",{className:"gf-form-group",onSubmit:e=>{e.preventDefault(),_(l)&&(n({name:i,role:r,secondsToLive:l}),s())},children:[v||(v=(0,f.jsx)("h5",{children:"Add API Key"})),(0,f.jsxs)("div",{className:"gf-form-inline",children:[(0,f.jsxs)("div",{className:"gf-form max-width-21",children:[k||(k=(0,f.jsx)("span",{className:"gf-form-label",children:"Key name"})),(0,f.jsx)(T,{type:"text",className:"gf-form-input",value:i,placeholder:"Name",onChange:e=>{a(e.currentTarget.value)}})]}),(0,f.jsx)("div",{className:"gf-form",children:(0,f.jsx)(g.InlineField,{label:"Role",children:(0,f.jsx)(g.Select,{inputId:"role-select",value:r,onChange:e=>{o(e.value)},options:D,menuShouldPortal:!0})})}),(0,f.jsx)("div",{className:"gf-form max-width-21",children:(0,f.jsx)(g.InlineField,{tooltip:"The API key life duration. For example, 1d if your key is going to last for one day. Supported units are: s,m,h,d,w,M,y",label:"Time to live",children:(0,f.jsx)(T,{id:"time-to-live-input",type:"text",placeholder:"1d",validationEvents:F,value:l,onChange:e=>{c(e.currentTarget.value)}})})}),A||(A=(0,f.jsx)("div",{className:"gf-form",children:(0,f.jsx)(g.Button,{children:"Add"})}))]})]})]})})},B=({searchQuery:e,disabled:s,onAddClick:n,onSearchChange:t})=>(0,f.jsxs)("div",{className:"page-action-bar",children:[(0,f.jsx)("div",{className:"gf-form gf-form--grow",children:(0,f.jsx)(g.FilterInput,{placeholder:"Search keys",value:e,onChange:t})}),(0,f.jsx)(g.Button,{className:"pull-right",onClick:n,disabled:s,children:"Add API key"})]});var Q,z,M;const L=({apiKeys:e,timeZone:s,onDelete:n})=>{const t=(0,g.useTheme2)(),i=R(t);return(0,f.jsxs)("table",{className:"filter-table",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[Q||(Q=(0,f.jsx)("th",{children:"Name"})),z||(z=(0,f.jsx)("th",{children:"Role"})),M||(M=(0,f.jsx)("th",{children:"Expires"})),(0,f.jsx)("th",{style:{width:"34px"}})]})}),e.length>0?(0,f.jsx)("tbody",{children:e.map((e=>{const t=Boolean(e.expiration&&Date.now()>new Date(e.expiration).getTime());return(0,f.jsxs)("tr",{className:i.tableRow(t),children:[(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.role}),(0,f.jsxs)("td",{children:[$(e.expiration,s),t&&(0,f.jsx)("span",{className:i.tooltipContainer,children:(0,f.jsx)(g.Tooltip,{content:"This API key has expired.",children:(0,f.jsx)(g.Icon,{name:"exclamation-triangle"})})})]}),(0,f.jsx)("td",{children:(0,f.jsx)(g.DeleteButton,{"aria-label":"Delete API key",size:"sm",onConfirm:()=>n(e)})})]},e.id)}))}):null]})};function $(e,s){return e?(0,I.dateTimeFormat)(e,{timeZone:s}):"No expiration date"}const R=e=>({tableRow:s=>m.css`
    color: ${s?e.colors.text.secondary:e.colors.text.primary};
  `,tooltipContainer:m.css`
    margin-left: ${e.spacing(1)};
  `}),O=({children:e})=>{const[s,n]=(0,t.useState)(!1),i=(0,t.useCallback)((()=>{n(!s)}),[s]);return e({isAdding:s,toggleIsAdding:i})};var U=n("./public/app/types/events.ts");function V(e,s,n){return s in e?Object.defineProperty(e,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[s]=n,e}const q={loadApiKeys:u,deleteApiKey:function(e){return async s=>{(0,d.i)().delete(`/api/auth/keys/${e}`).then((()=>s(u())))}},setSearchQuery:p.ql,toggleIncludeExpired:function(){return e=>{e((0,p.j4)())}},addApiKey:function(e,s){return async n=>{const t=await(0,d.i)().post("/api/auth/keys",e);n((0,p.ql)("")),n(u()),s(t.key)}}},Y=(0,i.connect)((function(e){return{navModel:(0,a.h)(e.navIndex,"apikeys"),apiKeys:o(e.apiKeys),searchQuery:e.apiKeys.searchQuery,apiKeysCount:r(e.apiKeys),hasFetched:e.apiKeys.hasFetched,timeZone:(0,E.Z)(e.user),includeExpired:l(e.apiKeys),includeExpiredDisabled:c(e.apiKeys)}}),q);class H extends t.PureComponent{constructor(e){super(e),V(this,"onDeleteApiKey",(e=>{this.props.deleteApiKey(e.id)})),V(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),V(this,"onIncludeExpiredChange",(e=>{this.props.toggleIncludeExpired()})),V(this,"onAddApiKey",(e=>{const s=e=>{const s=window.location.origin+C.ZP.appSubUrl;K.Z.publish(new U.Dn({props:{apiKey:e,rootPath:s},component:j}))},n=e.secondsToLive;try{const t=n?I.rangeUtil.intervalToSeconds(n):null,i=Object.assign({},e,{secondsToLive:t});this.props.addApiKey(i,s),this.setState((e=>Object.assign({},e,{isAdding:!1})))}catch(e){console.error(e)}}))}componentDidMount(){this.fetchApiKeys()}async fetchApiKeys(){await this.props.loadApiKeys()}render(){const{hasFetched:e,navModel:s,apiKeysCount:n,apiKeys:t,searchQuery:i,timeZone:a,includeExpired:r,includeExpiredDisabled:o}=this.props;return e?(0,f.jsx)(x.Z,{navModel:s,children:(0,f.jsx)(x.Z.Contents,{isLoading:!1,children:(0,f.jsx)(O,{children:({isAdding:e,toggleIsAdding:s})=>{const l=!e&&0===n,c=n>0;return(0,f.jsxs)(f.Fragment,{children:[l?(0,f.jsx)(w.Z,{title:"You haven't added any API keys yet.",buttonIcon:"key-skeleton-alt",onClick:s,buttonTitle:"New API key",proTip:"Remember, you can provide view-only API access to other applications."}):null,c?(0,f.jsx)(B,{searchQuery:i,disabled:e,onAddClick:s,onSearchChange:this.onSearchQueryChange}):null,(0,f.jsx)(Z,{show:e,onClose:s,onKeyAdded:this.onAddApiKey}),c?(0,f.jsxs)(g.VerticalGroup,{children:[(0,f.jsx)(g.InlineField,{disabled:o,label:"Include expired keys",children:(0,f.jsx)(g.InlineSwitch,{id:"showExpired",value:r,onChange:this.onIncludeExpiredChange})}),(0,f.jsx)(L,{apiKeys:t,timeZone:a,onDelete:this.onDeleteApiKey})]}):null]})}})})}):(0,f.jsx)(x.Z,{navModel:s,children:(0,f.jsx)(x.Z.Contents,{isLoading:!0})})}}const W=Y(H)}}]);
//# sourceMappingURL=ApiKeysPage.787ecc600122eb73aeab.js.map